
const pool = require('../../shared/config/database');

// ì¹´ì¹´ì˜¤ REST API í‚¤
const KAKAO_API_KEY = process.env.KAKAO_API_KEY;

if (!KAKAO_API_KEY) {
  console.error('âŒ KAKAO_API_KEY í™˜ê²½ë³€ìˆ˜ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
  console.log('ğŸ’¡ Secrets ë„êµ¬ì—ì„œ KAKAO_API_KEYë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”.');
  process.exit(1);
}

// API í˜¸ì¶œ ë”œë ˆì´
const delay = (ms) => new Promise(resolve => setTimeout(resolve, ms));

// ì „êµ­ ì‹œêµ°êµ¬ ëª©ë¡ (2024ë…„ ê¸°ì¤€)
const CITY_OFFICES = [
  // ì„œìš¸íŠ¹ë³„ì‹œ (25ê°œ êµ¬)
  'ì„œìš¸íŠ¹ë³„ì‹œ ì¢…ë¡œêµ¬ì²­', 'ì„œìš¸íŠ¹ë³„ì‹œ ì¤‘êµ¬ì²­', 'ì„œìš¸íŠ¹ë³„ì‹œ ìš©ì‚°êµ¬ì²­', 'ì„œìš¸íŠ¹ë³„ì‹œ ì„±ë™êµ¬ì²­', 'ì„œìš¸íŠ¹ë³„ì‹œ ê´‘ì§„êµ¬ì²­',
  'ì„œìš¸íŠ¹ë³„ì‹œ ë™ëŒ€ë¬¸êµ¬ì²­', 'ì„œìš¸íŠ¹ë³„ì‹œ ì¤‘ë‘êµ¬ì²­', 'ì„œìš¸íŠ¹ë³„ì‹œ ì„±ë¶êµ¬ì²­', 'ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë¶êµ¬ì²­', 'ì„œìš¸íŠ¹ë³„ì‹œ ë„ë´‰êµ¬ì²­',
  'ì„œìš¸íŠ¹ë³„ì‹œ ë…¸ì›êµ¬ì²­', 'ì„œìš¸íŠ¹ë³„ì‹œ ì€í‰êµ¬ì²­', 'ì„œìš¸íŠ¹ë³„ì‹œ ì„œëŒ€ë¬¸êµ¬ì²­', 'ì„œìš¸íŠ¹ë³„ì‹œ ë§ˆí¬êµ¬ì²­', 'ì„œìš¸íŠ¹ë³„ì‹œ ì–‘ì²œêµ¬ì²­',
  'ì„œìš¸íŠ¹ë³„ì‹œ ê°•ì„œêµ¬ì²­', 'ì„œìš¸íŠ¹ë³„ì‹œ êµ¬ë¡œêµ¬ì²­', 'ì„œìš¸íŠ¹ë³„ì‹œ ê¸ˆì²œêµ¬ì²­', 'ì„œìš¸íŠ¹ë³„ì‹œ ì˜ë“±í¬êµ¬ì²­', 'ì„œìš¸íŠ¹ë³„ì‹œ ë™ì‘êµ¬ì²­',
  'ì„œìš¸íŠ¹ë³„ì‹œ ê´€ì•…êµ¬ì²­', 'ì„œìš¸íŠ¹ë³„ì‹œ ì„œì´ˆêµ¬ì²­', 'ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ì²­', 'ì„œìš¸íŠ¹ë³„ì‹œ ì†¡íŒŒêµ¬ì²­', 'ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë™êµ¬ì²­',

  // ë¶€ì‚°ê´‘ì—­ì‹œ (16ê°œ êµ¬êµ°)
  'ë¶€ì‚°ê´‘ì—­ì‹œ ì¤‘êµ¬ì²­', 'ë¶€ì‚°ê´‘ì—­ì‹œ ì„œêµ¬ì²­', 'ë¶€ì‚°ê´‘ì—­ì‹œ ë™êµ¬ì²­', 'ë¶€ì‚°ê´‘ì—­ì‹œ ì˜ë„êµ¬ì²­', 'ë¶€ì‚°ê´‘ì—­ì‹œ ë¶€ì‚°ì§„êµ¬ì²­',
  'ë¶€ì‚°ê´‘ì—­ì‹œ ë™ë˜êµ¬ì²­', 'ë¶€ì‚°ê´‘ì—­ì‹œ ë‚¨êµ¬ì²­', 'ë¶€ì‚°ê´‘ì—­ì‹œ ë¶êµ¬ì²­', 'ë¶€ì‚°ê´‘ì—­ì‹œ í•´ìš´ëŒ€êµ¬ì²­', 'ë¶€ì‚°ê´‘ì—­ì‹œ ì‚¬í•˜êµ¬ì²­',
  'ë¶€ì‚°ê´‘ì—­ì‹œ ê¸ˆì •êµ¬ì²­', 'ë¶€ì‚°ê´‘ì—­ì‹œ ê°•ì„œêµ¬ì²­', 'ë¶€ì‚°ê´‘ì—­ì‹œ ì—°ì œêµ¬ì²­', 'ë¶€ì‚°ê´‘ì—­ì‹œ ìˆ˜ì˜êµ¬ì²­', 'ë¶€ì‚°ê´‘ì—­ì‹œ ì‚¬ìƒêµ¬ì²­',
  'ë¶€ì‚°ê´‘ì—­ì‹œ ê¸°ì¥êµ°ì²­',

  // ëŒ€êµ¬ê´‘ì—­ì‹œ (8ê°œ êµ¬êµ°)
  'ëŒ€êµ¬ê´‘ì—­ì‹œ ì¤‘êµ¬ì²­', 'ëŒ€êµ¬ê´‘ì—­ì‹œ ë™êµ¬ì²­', 'ëŒ€êµ¬ê´‘ì—­ì‹œ ì„œêµ¬ì²­', 'ëŒ€êµ¬ê´‘ì—­ì‹œ ë‚¨êµ¬ì²­',
  'ëŒ€êµ¬ê´‘ì—­ì‹œ ë¶êµ¬ì²­', 'ëŒ€êµ¬ê´‘ì—­ì‹œ ìˆ˜ì„±êµ¬ì²­', 'ëŒ€êµ¬ê´‘ì—­ì‹œ ë‹¬ì„œêµ¬ì²­', 'ëŒ€êµ¬ê´‘ì—­ì‹œ ë‹¬ì„±êµ°ì²­',

  // ì¸ì²œê´‘ì—­ì‹œ (10ê°œ êµ¬êµ°)
  'ì¸ì²œê´‘ì—­ì‹œ ì¤‘êµ¬ì²­', 'ì¸ì²œê´‘ì—­ì‹œ ë™êµ¬ì²­', 'ì¸ì²œê´‘ì—­ì‹œ ë¯¸ì¶”í™€êµ¬ì²­', 'ì¸ì²œê´‘ì—­ì‹œ ì—°ìˆ˜êµ¬ì²­', 'ì¸ì²œê´‘ì—­ì‹œ ë‚¨ë™êµ¬ì²­',
  'ì¸ì²œê´‘ì—­ì‹œ ë¶€í‰êµ¬ì²­', 'ì¸ì²œê´‘ì—­ì‹œ ê³„ì–‘êµ¬ì²­', 'ì¸ì²œê´‘ì—­ì‹œ ì„œêµ¬ì²­', 'ì¸ì²œê´‘ì—­ì‹œ ê°•í™”êµ°ì²­', 'ì¸ì²œê´‘ì—­ì‹œ ì˜¹ì§„êµ°ì²­',

  // ê´‘ì£¼ê´‘ì—­ì‹œ (5ê°œ êµ¬)
  'ê´‘ì£¼ê´‘ì—­ì‹œ ë™êµ¬ì²­', 'ê´‘ì£¼ê´‘ì—­ì‹œ ì„œêµ¬ì²­', 'ê´‘ì£¼ê´‘ì—­ì‹œ ë‚¨êµ¬ì²­', 'ê´‘ì£¼ê´‘ì—­ì‹œ ë¶êµ¬ì²­', 'ê´‘ì£¼ê´‘ì—­ì‹œ ê´‘ì‚°êµ¬ì²­',

  // ëŒ€ì „ê´‘ì—­ì‹œ (5ê°œ êµ¬)
  'ëŒ€ì „ê´‘ì—­ì‹œ ë™êµ¬ì²­', 'ëŒ€ì „ê´‘ì—­ì‹œ ì¤‘êµ¬ì²­', 'ëŒ€ì „ê´‘ì—­ì‹œ ì„œêµ¬ì²­', 'ëŒ€ì „ê´‘ì—­ì‹œ ìœ ì„±êµ¬ì²­', 'ëŒ€ì „ê´‘ì—­ì‹œ ëŒ€ë•êµ¬ì²­',

  // ìš¸ì‚°ê´‘ì—­ì‹œ (5ê°œ êµ¬êµ°)
  'ìš¸ì‚°ê´‘ì—­ì‹œ ì¤‘êµ¬ì²­', 'ìš¸ì‚°ê´‘ì—­ì‹œ ë‚¨êµ¬ì²­', 'ìš¸ì‚°ê´‘ì—­ì‹œ ë™êµ¬ì²­', 'ìš¸ì‚°ê´‘ì—­ì‹œ ë¶êµ¬ì²­', 'ìš¸ì‚°ê´‘ì—­ì‹œ ìš¸ì£¼êµ°ì²­',

  // ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ (1ê°œ)
  'ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œì²­',

  // ê²½ê¸°ë„ (31ê°œ ì‹œêµ°)
  'ê²½ê¸°ë„ ìˆ˜ì›ì‹œì²­', 'ê²½ê¸°ë„ ì„±ë‚¨ì‹œì²­', 'ê²½ê¸°ë„ ì˜ì •ë¶€ì‹œì²­', 'ê²½ê¸°ë„ ì•ˆì–‘ì‹œì²­', 'ê²½ê¸°ë„ ë¶€ì²œì‹œì²­',
  'ê²½ê¸°ë„ ê´‘ëª…ì‹œì²­', 'ê²½ê¸°ë„ í‰íƒì‹œì²­', 'ê²½ê¸°ë„ ë™ë‘ì²œì‹œì²­', 'ê²½ê¸°ë„ ì•ˆì‚°ì‹œì²­', 'ê²½ê¸°ë„ ê³ ì–‘ì‹œì²­',
  'ê²½ê¸°ë„ ê³¼ì²œì‹œì²­', 'ê²½ê¸°ë„ êµ¬ë¦¬ì‹œì²­', 'ê²½ê¸°ë„ ë‚¨ì–‘ì£¼ì‹œì²­', 'ê²½ê¸°ë„ ì˜¤ì‚°ì‹œì²­', 'ê²½ê¸°ë„ ì‹œí¥ì‹œì²­',
  'ê²½ê¸°ë„ êµ°í¬ì‹œì²­', 'ê²½ê¸°ë„ ì˜ì™•ì‹œì²­', 'ê²½ê¸°ë„ í•˜ë‚¨ì‹œì²­', 'ê²½ê¸°ë„ ìš©ì¸ì‹œì²­', 'ê²½ê¸°ë„ íŒŒì£¼ì‹œì²­',
  'ê²½ê¸°ë„ ì´ì²œì‹œì²­', 'ê²½ê¸°ë„ ì•ˆì„±ì‹œì²­', 'ê²½ê¸°ë„ ê¹€í¬ì‹œì²­', 'ê²½ê¸°ë„ í™”ì„±ì‹œì²­', 'ê²½ê¸°ë„ ê´‘ì£¼ì‹œì²­',
  'ê²½ê¸°ë„ ì–‘ì£¼ì‹œì²­', 'ê²½ê¸°ë„ í¬ì²œì‹œì²­', 'ê²½ê¸°ë„ ì—¬ì£¼ì‹œì²­', 'ê²½ê¸°ë„ ì—°ì²œêµ°ì²­', 'ê²½ê¸°ë„ ê°€í‰êµ°ì²­', 'ê²½ê¸°ë„ ì–‘í‰êµ°ì²­',

  // ê°•ì›ë„ (18ê°œ ì‹œêµ°)
  'ê°•ì›ë„ ì¶˜ì²œì‹œì²­', 'ê°•ì›ë„ ì›ì£¼ì‹œì²­', 'ê°•ì›ë„ ê°•ë¦‰ì‹œì²­', 'ê°•ì›ë„ ë™í•´ì‹œì²­', 'ê°•ì›ë„ íƒœë°±ì‹œì²­',
  'ê°•ì›ë„ ì†ì´ˆì‹œì²­', 'ê°•ì›ë„ ì‚¼ì²™ì‹œì²­', 'ê°•ì›ë„ í™ì²œêµ°ì²­', 'ê°•ì›ë„ íš¡ì„±êµ°ì²­', 'ê°•ì›ë„ ì˜ì›”êµ°ì²­',
  'ê°•ì›ë„ í‰ì°½êµ°ì²­', 'ê°•ì›ë„ ì •ì„ êµ°ì²­', 'ê°•ì›ë„ ì² ì›êµ°ì²­', 'ê°•ì›ë„ í™”ì²œêµ°ì²­', 'ê°•ì›ë„ ì–‘êµ¬êµ°ì²­',
  'ê°•ì›ë„ ì¸ì œêµ°ì²­', 'ê°•ì›ë„ ê³ ì„±êµ°ì²­', 'ê°•ì›ë„ ì–‘ì–‘êµ°ì²­',

  // ì¶©ì²­ë¶ë„ (11ê°œ ì‹œêµ°)
  'ì¶©ì²­ë¶ë„ ì²­ì£¼ì‹œì²­', 'ì¶©ì²­ë¶ë„ ì¶©ì£¼ì‹œì²­', 'ì¶©ì²­ë¶ë„ ì œì²œì‹œì²­', 'ì¶©ì²­ë¶ë„ ë³´ì€êµ°ì²­', 'ì¶©ì²­ë¶ë„ ì˜¥ì²œêµ°ì²­',
  'ì¶©ì²­ë¶ë„ ì˜ë™êµ°ì²­', 'ì¶©ì²­ë¶ë„ ì¦í‰êµ°ì²­', 'ì¶©ì²­ë¶ë„ ì§„ì²œêµ°ì²­', 'ì¶©ì²­ë¶ë„ ê´´ì‚°êµ°ì²­', 'ì¶©ì²­ë¶ë„ ìŒì„±êµ°ì²­', 'ì¶©ì²­ë¶ë„ ë‹¨ì–‘êµ°ì²­',

  // ì¶©ì²­ë‚¨ë„ (15ê°œ ì‹œêµ°)
  'ì¶©ì²­ë‚¨ë„ ì²œì•ˆì‹œì²­', 'ì¶©ì²­ë‚¨ë„ ê³µì£¼ì‹œì²­', 'ì¶©ì²­ë‚¨ë„ ë³´ë ¹ì‹œì²­', 'ì¶©ì²­ë‚¨ë„ ì•„ì‚°ì‹œì²­', 'ì¶©ì²­ë‚¨ë„ ì„œì‚°ì‹œì²­',
  'ì¶©ì²­ë‚¨ë„ ë…¼ì‚°ì‹œì²­', 'ì¶©ì²­ë‚¨ë„ ê³„ë£¡ì‹œì²­', 'ì¶©ì²­ë‚¨ë„ ë‹¹ì§„ì‹œì²­', 'ì¶©ì²­ë‚¨ë„ ê¸ˆì‚°êµ°ì²­', 'ì¶©ì²­ë‚¨ë„ ë¶€ì—¬êµ°ì²­',
  'ì¶©ì²­ë‚¨ë„ ì„œì²œêµ°ì²­', 'ì¶©ì²­ë‚¨ë„ ì²­ì–‘êµ°ì²­', 'ì¶©ì²­ë‚¨ë„ í™ì„±êµ°ì²­', 'ì¶©ì²­ë‚¨ë„ ì˜ˆì‚°êµ°ì²­', 'ì¶©ì²­ë‚¨ë„ íƒœì•ˆêµ°ì²­',

  // ì „ë¼ë¶ë„ (14ê°œ ì‹œêµ°)
  'ì „ë¼ë¶ë„ ì „ì£¼ì‹œì²­', 'ì „ë¼ë¶ë„ êµ°ì‚°ì‹œì²­', 'ì „ë¼ë¶ë„ ìµì‚°ì‹œì²­', 'ì „ë¼ë¶ë„ ì •ìì‹œì²­', 'ì „ë¼ë¶ë„ ë‚¨ì›ì‹œì²­',
  'ì „ë¼ë¶ë„ ê¹€ì œì‹œì²­', 'ì „ë¼ë¶ë„ ì™„ì£¼êµ°ì²­', 'ì „ë¼ë¶ë„ ì§„ì•ˆêµ°ì²­', 'ì „ë¼ë¶ë„ ë¬´ì£¼êµ°ì²­', 'ì „ë¼ë¶ë„ ì¥ìˆ˜êµ°ì²­',
  'ì „ë¼ë¶ë„ ì„ì‹¤êµ°ì²­', 'ì „ë¼ë¶ë„ ìˆœì°½êµ°ì²­', 'ì „ë¼ë¶ë„ ê³ ì°½êµ°ì²­', 'ì „ë¼ë¶ë„ ë¶€ì•ˆêµ°ì²­',

  // ì „ë¼ë‚¨ë„ (22ê°œ ì‹œêµ°)
  'ì „ë¼ë‚¨ë„ ëª©í¬ì‹œì²­', 'ì „ë¼ë‚¨ë„ ì—¬ìˆ˜ì‹œì²­', 'ì „ë¼ë‚¨ë„ ìˆœì²œì‹œì²­', 'ì „ë¼ë‚¨ë„ ë‚˜ì£¼ì‹œì²­', 'ì „ë¼ë‚¨ë„ ê´‘ì–‘ì‹œì²­',
  'ì „ë¼ë‚¨ë„ ë‹´ì–‘êµ°ì²­', 'ì „ë¼ë‚¨ë„ ê³¡ì„±êµ°ì²­', 'ì „ë¼ë‚¨ë„ êµ¬ë¡€êµ°ì²­', 'ì „ë¼ë‚¨ë„ ê³ í¥êµ°ì²­', 'ì „ë¼ë‚¨ë„ ë³´ì„±êµ°ì²­',
  'ì „ë¼ë‚¨ë„ í™”ìˆœêµ°ì²­', 'ì „ë¼ë‚¨ë„ ì¥í¥êµ°ì²­', 'ì „ë¼ë‚¨ë„ ê°•ì§„êµ°ì²­', 'ì „ë¼ë‚¨ë„ í•´ë‚¨êµ°ì²­', 'ì „ë¼ë‚¨ë„ ì˜ì•”êµ°ì²­',
  'ì „ë¼ë‚¨ë„ ë¬´ì•ˆêµ°ì²­', 'ì „ë¼ë‚¨ë„ í•¨í‰êµ°ì²­', 'ì „ë¼ë‚¨ë„ ì˜ê´‘êµ°ì²­', 'ì „ë¼ë‚¨ë„ ì¥ì„±êµ°ì²­', 'ì „ë¼ë‚¨ë„ ì™„ë„êµ°ì²­',
  'ì „ë¼ë‚¨ë„ ì§„ë„êµ°ì²­', 'ì „ë¼ë‚¨ë„ ì‹ ì•ˆêµ°ì²­',

  // ê²½ìƒë¶ë„ (23ê°œ ì‹œêµ°)
  'ê²½ìƒë¶ë„ í¬í•­ì‹œì²­', 'ê²½ìƒë¶ë„ ê²½ì£¼ì‹œì²­', 'ê²½ìƒë¶ë„ ê¹€ì²œì‹œì²­', 'ê²½ìƒë¶ë„ ì•ˆë™ì‹œì²­', 'ê²½ìƒë¶ë„ êµ¬ë¯¸ì‹œì²­',
  'ê²½ìƒë¶ë„ ì˜ì£¼ì‹œì²­', 'ê²½ìƒë¶ë„ ì˜ì²œì‹œì²­', 'ê²½ìƒë¶ë„ ìƒì£¼ì‹œì²­', 'ê²½ìƒë¶ë„ ë¬¸ê²½ì‹œì²­', 'ê²½ìƒë¶ë„ ê²½ì‚°ì‹œì²­',
  'ê²½ìƒë¶ë„ êµ°ìœ„êµ°ì²­', 'ê²½ìƒë¶ë„ ì˜ì„±êµ°ì²­', 'ê²½ìƒë¶ë„ ì²­ì†¡êµ°ì²­', 'ê²½ìƒë¶ë„ ì˜ì–‘êµ°ì²­', 'ê²½ìƒë¶ë„ ì˜ë•êµ°ì²­',
  'ê²½ìƒë¶ë„ ì²­ë„êµ°ì²­', 'ê²½ìƒë¶ë„ ê³ ë ¹êµ°ì²­', 'ê²½ìƒë¶ë„ ì„±ì£¼êµ°ì²­', 'ê²½ìƒë¶ë„ ì¹ ê³¡êµ°ì²­', 'ê²½ìƒë¶ë„ ì˜ˆì²œêµ°ì²­',
  'ê²½ìƒë¶ë„ ë´‰í™”êµ°ì²­', 'ê²½ìƒë¶ë„ ìš¸ì§„êµ°ì²­', 'ê²½ìƒë¶ë„ ìš¸ë¦‰êµ°ì²­',

  // ê²½ìƒë‚¨ë„ (18ê°œ ì‹œêµ°)
  'ê²½ìƒë‚¨ë„ ì°½ì›ì‹œì²­', 'ê²½ìƒë‚¨ë„ ì§„ì£¼ì‹œì²­', 'ê²½ìƒë‚¨ë„ í†µì˜ì‹œì²­', 'ê²½ìƒë‚¨ë„ ì‚¬ì²œì‹œì²­', 'ê²½ìƒë‚¨ë„ ê¹€í•´ì‹œì²­',
  'ê²½ìƒë‚¨ë„ ë°€ì–‘ì‹œì²­', 'ê²½ìƒë‚¨ë„ ê±°ì œì‹œì²­', 'ê²½ìƒë‚¨ë„ ì–‘ì‚°ì‹œì²­', 'ê²½ìƒë‚¨ë„ ì˜ë ¹êµ°ì²­', 'ê²½ìƒë‚¨ë„ í•¨ì•ˆêµ°ì²­',
  'ê²½ìƒë‚¨ë„ ì°½ë…•êµ°ì²­', 'ê²½ìƒë‚¨ë„ ê³ ì„±êµ°ì²­', 'ê²½ìƒë‚¨ë„ ë‚¨í•´êµ°ì²­', 'ê²½ìƒë‚¨ë„ í•˜ë™êµ°ì²­', 'ê²½ìƒë‚¨ë„ ì‚°ì²­êµ°ì²­',
  'ê²½ìƒë‚¨ë„ í•¨ì–‘êµ°ì²­', 'ê²½ìƒë‚¨ë„ ê±°ì°½êµ°ì²­', 'ê²½ìƒë‚¨ë„ í•©ì²œêµ°ì²­',

  // ì œì£¼íŠ¹ë³„ìì¹˜ë„ (2ê°œ)
  'ì œì£¼íŠ¹ë³„ìì¹˜ë„ ì œì£¼ì‹œì²­', 'ì œì£¼íŠ¹ë³„ìì¹˜ë„ ì„œê·€í¬ì‹œì²­'
];

// ì¹´ì¹´ì˜¤ ì¥ì†Œ ê²€ìƒ‰ API í˜¸ì¶œ
async function searchOfficeLocation(officeName) {
  try {
    const response = await fetch(
      `https://dapi.kakao.com/v2/local/search/keyword.json?query=${encodeURIComponent(officeName)}`,
      {
        headers: {
          'Authorization': `KakaoAK ${KAKAO_API_KEY}`
        }
      }
    );

    if (!response.ok) {
      console.log(`âŒ ${officeName} API í˜¸ì¶œ ì‹¤íŒ¨: ${response.status}`);
      return null;
    }

    const data = await response.json();
    
    if (data.documents && data.documents.length > 0) {
      const place = data.documents[0]; // ì²« ë²ˆì§¸ ê²°ê³¼ ì‚¬ìš©
      return {
        name: officeName,
        latitude: parseFloat(place.y),
        longitude: parseFloat(place.x),
        address: place.address_name || place.road_address_name || ''
      };
    }
    
    console.log(`âš ï¸ ${officeName} ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ`);
    return null;
    
  } catch (error) {
    console.error(`âŒ ${officeName} ê²€ìƒ‰ ì‹¤íŒ¨:`, error.message);
    return null;
  }
}

async function importCityOffices() {
  try {
    console.log('ğŸ›ï¸ ì „êµ­ ì‹œì²­/êµ°ì²­/êµ¬ì²­ ì¢Œí‘œ ê°€ì ¸ì˜¤ê¸° ì‹œì‘...');
    console.log(`ğŸ“Š ëŒ€ìƒ ê´€ì²­ ìˆ˜: ${CITY_OFFICES.length}ê°œ`);
    
    // administrative_offices í…Œì´ë¸” ìƒì„±
    await pool.query(`
      CREATE TABLE IF NOT EXISTS administrative_offices (
        id SERIAL PRIMARY KEY,
        region_type VARCHAR(20) NOT NULL,
        region_name VARCHAR(100) NOT NULL,
        office_name VARCHAR(100) NOT NULL,
        latitude DECIMAL(10, 8) NOT NULL,
        longitude DECIMAL(11, 8) NOT NULL,
        address TEXT,
        created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
        UNIQUE(office_name)
      );
    `);
    
    console.log('âœ… administrative_offices í…Œì´ë¸” ì¤€ë¹„ ì™„ë£Œ');
    
    // ê¸°ì¡´ ë°ì´í„° ì‚­ì œ
    await pool.query('DELETE FROM administrative_offices');
    console.log('ğŸ—‘ï¸ ê¸°ì¡´ ë°ì´í„° ì‚­ì œ ì™„ë£Œ');
    
    let successCount = 0;
    let failCount = 0;
    
    for (let i = 0; i < CITY_OFFICES.length; i++) {
      const officeName = CITY_OFFICES[i];
      
      console.log(`ğŸ” [${i + 1}/${CITY_OFFICES.length}] ${officeName} ê²€ìƒ‰ ì¤‘...`);
      
      const result = await searchOfficeLocation(officeName);
      
      if (result) {
        try {
          // ì§€ì—­ ì •ë³´ íŒŒì‹±
          const parts = officeName.split(' ');
          let regionType = '';
          let regionName = '';
          
          if (parts.length >= 2) {
            if (parts[0].includes('íŠ¹ë³„ì‹œ') || parts[0].includes('ê´‘ì—­ì‹œ') || parts[0].includes('íŠ¹ë³„ìì¹˜ì‹œ')) {
              regionType = 'metropolitan';
              regionName = parts[1].replace('ì²­', '');
            } else if (parts[0].includes('ë„')) {
              regionType = 'province';
              regionName = parts[1].replace('ì²­', '');
            } else {
              regionType = 'city';
              regionName = parts[0] + ' ' + parts[1].replace('ì²­', '');
            }
          }
          
          await pool.query(`
            INSERT INTO administrative_offices (region_type, region_name, office_name, latitude, longitude, address)
            VALUES ($1, $2, $3, $4, $5, $6)
          `, [regionType, regionName, result.name, result.latitude, result.longitude, result.address]);
          
          console.log(`âœ… ${result.name}: (${result.latitude}, ${result.longitude})`);
          successCount++;
          
        } catch (error) {
          console.error(`âŒ ${officeName} DB ì €ì¥ ì‹¤íŒ¨:`, error.message);
          failCount++;
        }
      } else {
        failCount++;
      }
      
      // API í˜¸ì¶œ ì œí•œì„ ìœ„í•œ ë”œë ˆì´
      await delay(200);
      
      // ì§„í–‰ìƒí™© í‘œì‹œ
      if ((i + 1) % 25 === 0) {
        console.log(`ğŸ“Š ì§„í–‰ìƒí™©: ${i + 1}/${CITY_OFFICES.length} (ì„±ê³µ: ${successCount}, ì‹¤íŒ¨: ${failCount})`);
      }
    }
    
    // ìµœì¢… ê²°ê³¼ í™•ì¸
    const totalResult = await pool.query('SELECT COUNT(*) as count FROM administrative_offices');
    
    console.log(`\nğŸ‰ ì „êµ­ ì‹œì²­/êµ°ì²­/êµ¬ì²­ ì¢Œí‘œ ê°€ì ¸ì˜¤ê¸° ì™„ë£Œ!`);
    console.log(`ğŸ“Š ìµœì¢… ê²°ê³¼:`);
    console.log(`  - ì„±ê³µ: ${successCount}ê°œ`);
    console.log(`  - ì‹¤íŒ¨: ${failCount}ê°œ`);
    console.log(`  - DB ì €ì¥ëœ ì´ ê´€ì²­ ìˆ˜: ${totalResult.rows[0].count}ê°œ`);
    
    // ì§€ì—­ë³„ í†µê³„
    const regionStats = await pool.query(`
      SELECT region_type, COUNT(*) as count 
      FROM administrative_offices 
      GROUP BY region_type 
      ORDER BY count DESC
    `);
    
    console.log(`\nğŸ“ˆ ì§€ì—­ë³„ í†µê³„:`);
    regionStats.rows.forEach(stat => {
      console.log(`  - ${stat.region_type}: ${stat.count}ê°œ`);
    });
    
    // ê²€ì¦: ëª©í‘œ 250ê°œì™€ ë¹„êµ
    const actualCount = parseInt(totalResult.rows[0].count);
    const expectedCount = 250;
    
    console.log(`\nğŸ” ê²€ì¦ ê²°ê³¼:`);
    console.log(`  - ëª©í‘œ ê´€ì²­ ìˆ˜: ${expectedCount}ê°œ`);
    console.log(`  - ì‹¤ì œ ì €ì¥ëœ ìˆ˜: ${actualCount}ê°œ`);
    console.log(`  - ì°¨ì´: ${Math.abs(expectedCount - actualCount)}ê°œ`);
    
    if (actualCount >= 245) { // 95% ì´ìƒì´ë©´ ì„±ê³µìœ¼ë¡œ ê°„ì£¼
      console.log(`âœ… ê²€ì¦ ì„±ê³µ! ì¶©ë¶„í•œ ìˆ˜ì˜ ê´€ì²­ ì¢Œí‘œë¥¼ ìˆ˜ì§‘í–ˆìŠµë‹ˆë‹¤.`);
    } else {
      console.log(`âš ï¸ ê²€ì¦ ì£¼ì˜! ì¼ë¶€ ê´€ì²­ ì¢Œí‘œë¥¼ ê°€ì ¸ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.`);
    }
    
    // ìƒ˜í”Œ ë°ì´í„° í™•ì¸
    const samples = await pool.query(`
      SELECT office_name, latitude, longitude, address 
      FROM administrative_offices 
      ORDER BY RANDOM() 
      LIMIT 10
    `);
    
    console.log(`\nğŸ“ ìƒ˜í”Œ ë°ì´í„°:`);
    samples.rows.forEach(office => {
      console.log(`  - ${office.office_name}: (${office.latitude}, ${office.longitude})`);
      console.log(`    ì£¼ì†Œ: ${office.address}`);
    });
    
  } catch (error) {
    console.error('âŒ ì‹œì²­/êµ°ì²­/êµ¬ì²­ ì¢Œí‘œ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error);
    console.error('âŒ ì—ëŸ¬ ì„¸ë¶€ì‚¬í•­:', error.message);
  } finally {
    process.exit(0);
  }
}

// ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
importCityOffices();
