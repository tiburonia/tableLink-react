
const pool = require('../../shared/config/database');

// ì¹´ì¹´ì˜¤ REST API í‚¤
const KAKAO_API_KEY = process.env.KAKAO_API_KEY;

if (!KAKAO_API_KEY) {
  console.error('âŒ KAKAO_API_KEY í™˜ê²½ë³€ìˆ˜ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
  console.log('ğŸ’¡ Secrets ë„êµ¬ì—ì„œ KAKAO_API_KEYë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”.');
  process.exit(1);
}

// API í˜¸ì¶œ ë”œë ˆì´
const delay = (ms) => new Promise(resolve => setTimeout(resolve, ms));

// ì „êµ­ 17ê°œ ì‹œë„ì²­ (ì •í™•í•œ ì¢Œí‘œ)
const SIDO_OFFICES = [
  { name: 'ì„œìš¸íŠ¹ë³„ì‹œì²­', regionName: 'ì„œìš¸íŠ¹ë³„ì‹œ', lat: 37.5666103, lng: 126.9783882 },
  { name: 'ë¶€ì‚°ê´‘ì—­ì‹œì²­', regionName: 'ë¶€ì‚°ê´‘ì—­ì‹œ', lat: 35.1798159, lng: 129.0750222 },
  { name: 'ëŒ€êµ¬ê´‘ì—­ì‹œì²­', regionName: 'ëŒ€êµ¬ê´‘ì—­ì‹œ', lat: 35.8714354, lng: 128.601445 },
  { name: 'ì¸ì²œê´‘ì—­ì‹œì²­', regionName: 'ì¸ì²œê´‘ì—­ì‹œ', lat: 37.4563842, lng: 126.7052062 },
  { name: 'ê´‘ì£¼ê´‘ì—­ì‹œì²­', regionName: 'ê´‘ì£¼ê´‘ì—­ì‹œ', lat: 35.1595454, lng: 126.8526012 },
  { name: 'ëŒ€ì „ê´‘ì—­ì‹œì²­', regionName: 'ëŒ€ì „ê´‘ì—­ì‹œ', lat: 36.3504119, lng: 127.3845475 },
  { name: 'ìš¸ì‚°ê´‘ì—­ì‹œì²­', regionName: 'ìš¸ì‚°ê´‘ì—­ì‹œ', lat: 35.5383773, lng: 129.3113596 },
  { name: 'ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œì²­', regionName: 'ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ', lat: 36.4800984, lng: 127.2890069 },
  { name: 'ê²½ê¸°ë„ì²­', regionName: 'ê²½ê¸°ë„', lat: 37.2635727, lng: 127.0286009 },
  { name: 'ê°•ì›íŠ¹ë³„ìì¹˜ë„ì²­', regionName: 'ê°•ì›íŠ¹ë³„ìì¹˜ë„', lat: 37.8813153, lng: 127.7298935 },
  { name: 'ì¶©ì²­ë¶ë„ì²­', regionName: 'ì¶©ì²­ë¶ë„', lat: 36.6357734, lng: 127.4917998 },
  { name: 'ì¶©ì²­ë‚¨ë„ì²­', regionName: 'ì¶©ì²­ë‚¨ë„', lat: 36.5596065, lng: 126.6728311 },
  { name: 'ì „ë¶íŠ¹ë³„ìì¹˜ë„ì²­', regionName: 'ì „ë¶íŠ¹ë³„ìì¹˜ë„', lat: 35.8242238, lng: 127.1479532 },
  { name: 'ì „ë¼ë‚¨ë„ì²­', regionName: 'ì „ë¼ë‚¨ë„', lat: 34.8194351, lng: 126.8930906 },
  { name: 'ê²½ìƒë¶ë„ì²­', regionName: 'ê²½ìƒë¶ë„', lat: 36.5759107, lng: 128.5055956 },
  { name: 'ê²½ìƒë‚¨ë„ì²­', regionName: 'ê²½ìƒë‚¨ë„', lat: 35.2383773, lng: 128.6923449 },
  { name: 'ì œì£¼íŠ¹ë³„ìì¹˜ë„ì²­', regionName: 'ì œì£¼íŠ¹ë³„ìì¹˜ë„', lat: 33.4890113, lng: 126.4983023 }
];

// ì „êµ­ ì‹œêµ°êµ¬ ëª©ë¡ (229ê°œ)
const CITY_OFFICES = [
  // ì„œìš¸íŠ¹ë³„ì‹œ (25ê°œ êµ¬)
  'ì„œìš¸íŠ¹ë³„ì‹œ ì¢…ë¡œêµ¬ì²­', 'ì„œìš¸íŠ¹ë³„ì‹œ ì¤‘êµ¬ì²­', 'ì„œìš¸íŠ¹ë³„ì‹œ ìš©ì‚°êµ¬ì²­', 'ì„œìš¸íŠ¹ë³„ì‹œ ì„±ë™êµ¬ì²­', 'ì„œìš¸íŠ¹ë³„ì‹œ ê´‘ì§„êµ¬ì²­',
  'ì„œìš¸íŠ¹ë³„ì‹œ ë™ëŒ€ë¬¸êµ¬ì²­', 'ì„œìš¸íŠ¹ë³„ì‹œ ì¤‘ë‘êµ¬ì²­', 'ì„œìš¸íŠ¹ë³„ì‹œ ì„±ë¶êµ¬ì²­', 'ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë¶êµ¬ì²­', 'ì„œìš¸íŠ¹ë³„ì‹œ ë„ë´‰êµ¬ì²­',
  'ì„œìš¸íŠ¹ë³„ì‹œ ë…¸ì›êµ¬ì²­', 'ì„œìš¸íŠ¹ë³„ì‹œ ì€í‰êµ¬ì²­', 'ì„œìš¸íŠ¹ë³„ì‹œ ì„œëŒ€ë¬¸êµ¬ì²­', 'ì„œìš¸íŠ¹ë³„ì‹œ ë§ˆí¬êµ¬ì²­', 'ì„œìš¸íŠ¹ë³„ì‹œ ì–‘ì²œêµ¬ì²­',
  'ì„œìš¸íŠ¹ë³„ì‹œ ê°•ì„œêµ¬ì²­', 'ì„œìš¸íŠ¹ë³„ì‹œ êµ¬ë¡œêµ¬ì²­', 'ì„œìš¸íŠ¹ë³„ì‹œ ê¸ˆì²œêµ¬ì²­', 'ì„œìš¸íŠ¹ë³„ì‹œ ì˜ë“±í¬êµ¬ì²­', 'ì„œìš¸íŠ¹ë³„ì‹œ ë™ì‘êµ¬ì²­',
  'ì„œìš¸íŠ¹ë³„ì‹œ ê´€ì•…êµ¬ì²­', 'ì„œìš¸íŠ¹ë³„ì‹œ ì„œì´ˆêµ¬ì²­', 'ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ì²­', 'ì„œìš¸íŠ¹ë³„ì‹œ ì†¡íŒŒêµ¬ì²­', 'ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë™êµ¬ì²­',

  // ë¶€ì‚°ê´‘ì—­ì‹œ (16ê°œ êµ¬êµ°)
  'ë¶€ì‚°ê´‘ì—­ì‹œ ì¤‘êµ¬ì²­', 'ë¶€ì‚°ê´‘ì—­ì‹œ ì„œêµ¬ì²­', 'ë¶€ì‚°ê´‘ì—­ì‹œ ë™êµ¬ì²­', 'ë¶€ì‚°ê´‘ì—­ì‹œ ì˜ë„êµ¬ì²­', 'ë¶€ì‚°ê´‘ì—­ì‹œ ë¶€ì‚°ì§„êµ¬ì²­',
  'ë¶€ì‚°ê´‘ì—­ì‹œ ë™ë˜êµ¬ì²­', 'ë¶€ì‚°ê´‘ì—­ì‹œ ë‚¨êµ¬ì²­', 'ë¶€ì‚°ê´‘ì—­ì‹œ ë¶êµ¬ì²­', 'ë¶€ì‚°ê´‘ì—­ì‹œ í•´ìš´ëŒ€êµ¬ì²­', 'ë¶€ì‚°ê´‘ì—­ì‹œ ì‚¬í•˜êµ¬ì²­',
  'ë¶€ì‚°ê´‘ì—­ì‹œ ê¸ˆì •êµ¬ì²­', 'ë¶€ì‚°ê´‘ì—­ì‹œ ê°•ì„œêµ¬ì²­', 'ë¶€ì‚°ê´‘ì—­ì‹œ ì—°ì œêµ¬ì²­', 'ë¶€ì‚°ê´‘ì—­ì‹œ ìˆ˜ì˜êµ¬ì²­', 'ë¶€ì‚°ê´‘ì—­ì‹œ ì‚¬ìƒêµ¬ì²­',
  'ë¶€ì‚°ê´‘ì—­ì‹œ ê¸°ì¥êµ°ì²­',

  // ëŒ€êµ¬ê´‘ì—­ì‹œ (8ê°œ êµ¬êµ°)
  'ëŒ€êµ¬ê´‘ì—­ì‹œ ì¤‘êµ¬ì²­', 'ëŒ€êµ¬ê´‘ì—­ì‹œ ë™êµ¬ì²­', 'ëŒ€êµ¬ê´‘ì—­ì‹œ ì„œêµ¬ì²­', 'ëŒ€êµ¬ê´‘ì—­ì‹œ ë‚¨êµ¬ì²­',
  'ëŒ€êµ¬ê´‘ì—­ì‹œ ë¶êµ¬ì²­', 'ëŒ€êµ¬ê´‘ì—­ì‹œ ìˆ˜ì„±êµ¬ì²­', 'ëŒ€êµ¬ê´‘ì—­ì‹œ ë‹¬ì„œêµ¬ì²­', 'ëŒ€êµ¬ê´‘ì—­ì‹œ ë‹¬ì„±êµ°ì²­',

  // ì¸ì²œê´‘ì—­ì‹œ (10ê°œ êµ¬êµ°)
  'ì¸ì²œê´‘ì—­ì‹œ ì¤‘êµ¬ì²­', 'ì¸ì²œê´‘ì—­ì‹œ ë™êµ¬ì²­', 'ì¸ì²œê´‘ì—­ì‹œ ë¯¸ì¶”í™€êµ¬ì²­', 'ì¸ì²œê´‘ì—­ì‹œ ì—°ìˆ˜êµ¬ì²­', 'ì¸ì²œê´‘ì—­ì‹œ ë‚¨ë™êµ¬ì²­',
  'ì¸ì²œê´‘ì—­ì‹œ ë¶€í‰êµ¬ì²­', 'ì¸ì²œê´‘ì—­ì‹œ ê³„ì–‘êµ¬ì²­', 'ì¸ì²œê´‘ì—­ì‹œ ì„œêµ¬ì²­', 'ì¸ì²œê´‘ì—­ì‹œ ê°•í™”êµ°ì²­', 'ì¸ì²œê´‘ì—­ì‹œ ì˜¹ì§„êµ°ì²­',

  // ê´‘ì£¼ê´‘ì—­ì‹œ (5ê°œ êµ¬)
  'ê´‘ì£¼ê´‘ì—­ì‹œ ë™êµ¬ì²­', 'ê´‘ì£¼ê´‘ì—­ì‹œ ì„œêµ¬ì²­', 'ê´‘ì£¼ê´‘ì—­ì‹œ ë‚¨êµ¬ì²­', 'ê´‘ì£¼ê´‘ì—­ì‹œ ë¶êµ¬ì²­', 'ê´‘ì£¼ê´‘ì—­ì‹œ ê´‘ì‚°êµ¬ì²­',

  // ëŒ€ì „ê´‘ì—­ì‹œ (5ê°œ êµ¬)
  'ëŒ€ì „ê´‘ì—­ì‹œ ë™êµ¬ì²­', 'ëŒ€ì „ê´‘ì—­ì‹œ ì¤‘êµ¬ì²­', 'ëŒ€ì „ê´‘ì—­ì‹œ ì„œêµ¬ì²­', 'ëŒ€ì „ê´‘ì—­ì‹œ ìœ ì„±êµ¬ì²­', 'ëŒ€ì „ê´‘ì—­ì‹œ ëŒ€ë•êµ¬ì²­',

  // ìš¸ì‚°ê´‘ì—­ì‹œ (5ê°œ êµ¬êµ°)
  'ìš¸ì‚°ê´‘ì—­ì‹œ ì¤‘êµ¬ì²­', 'ìš¸ì‚°ê´‘ì—­ì‹œ ë‚¨êµ¬ì²­', 'ìš¸ì‚°ê´‘ì—­ì‹œ ë™êµ¬ì²­', 'ìš¸ì‚°ê´‘ì—­ì‹œ ë¶êµ¬ì²­', 'ìš¸ì‚°ê´‘ì—­ì‹œ ìš¸ì£¼êµ°ì²­',

  // ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ (1ê°œ)
  'ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œì²­',

  // ê²½ê¸°ë„ (31ê°œ ì‹œêµ°)
  'ê²½ê¸°ë„ ìˆ˜ì›ì‹œì²­', 'ê²½ê¸°ë„ ì„±ë‚¨ì‹œì²­', 'ê²½ê¸°ë„ ì˜ì •ë¶€ì‹œì²­', 'ê²½ê¸°ë„ ì•ˆì–‘ì‹œì²­', 'ê²½ê¸°ë„ ë¶€ì²œì‹œì²­',
  'ê²½ê¸°ë„ ê´‘ëª…ì‹œì²­', 'ê²½ê¸°ë„ í‰íƒì‹œì²­', 'ê²½ê¸°ë„ ë™ë‘ì²œì‹œì²­', 'ê²½ê¸°ë„ ì•ˆì‚°ì‹œì²­', 'ê²½ê¸°ë„ ê³ ì–‘ì‹œì²­',
  'ê²½ê¸°ë„ ê³¼ì²œì‹œì²­', 'ê²½ê¸°ë„ êµ¬ë¦¬ì‹œì²­', 'ê²½ê¸°ë„ ë‚¨ì–‘ì£¼ì‹œì²­', 'ê²½ê¸°ë„ ì˜¤ì‚°ì‹œì²­', 'ê²½ê¸°ë„ ì‹œí¥ì‹œì²­',
  'ê²½ê¸°ë„ êµ°í¬ì‹œì²­', 'ê²½ê¸°ë„ ì˜ì™•ì‹œì²­', 'ê²½ê¸°ë„ í•˜ë‚¨ì‹œì²­', 'ê²½ê¸°ë„ ìš©ì¸ì‹œì²­', 'ê²½ê¸°ë„ íŒŒì£¼ì‹œì²­',
  'ê²½ê¸°ë„ ì´ì²œì‹œì²­', 'ê²½ê¸°ë„ ì•ˆì„±ì‹œì²­', 'ê²½ê¸°ë„ ê¹€í¬ì‹œì²­', 'ê²½ê¸°ë„ í™”ì„±ì‹œì²­', 'ê²½ê¸°ë„ ê´‘ì£¼ì‹œì²­',
  'ê²½ê¸°ë„ ì–‘ì£¼ì‹œì²­', 'ê²½ê¸°ë„ í¬ì²œì‹œì²­', 'ê²½ê¸°ë„ ì—¬ì£¼ì‹œì²­', 'ê²½ê¸°ë„ ì—°ì²œêµ°ì²­', 'ê²½ê¸°ë„ ê°€í‰êµ°ì²­', 'ê²½ê¸°ë„ ì–‘í‰êµ°ì²­',

  // ê°•ì›íŠ¹ë³„ìì¹˜ë„ (18ê°œ ì‹œêµ°)
  'ê°•ì›íŠ¹ë³„ìì¹˜ë„ ì¶˜ì²œì‹œì²­', 'ê°•ì›íŠ¹ë³„ìì¹˜ë„ ì›ì£¼ì‹œì²­', 'ê°•ì›íŠ¹ë³„ìì¹˜ë„ ê°•ë¦‰ì‹œì²­', 'ê°•ì›íŠ¹ë³„ìì¹˜ë„ ë™í•´ì‹œì²­', 'ê°•ì›íŠ¹ë³„ìì¹˜ë„ íƒœë°±ì‹œì²­',
  'ê°•ì›íŠ¹ë³„ìì¹˜ë„ ì†ì´ˆì‹œì²­', 'ê°•ì›íŠ¹ë³„ìì¹˜ë„ ì‚¼ì²™ì‹œì²­', 'ê°•ì›íŠ¹ë³„ìì¹˜ë„ í™ì²œêµ°ì²­', 'ê°•ì›íŠ¹ë³„ìì¹˜ë„ íš¡ì„±êµ°ì²­', 'ê°•ì›íŠ¹ë³„ìì¹˜ë„ ì˜ì›”êµ°ì²­',
  'ê°•ì›íŠ¹ë³„ìì¹˜ë„ í‰ì°½êµ°ì²­', 'ê°•ì›íŠ¹ë³„ìì¹˜ë„ ì •ì„ êµ°ì²­', 'ê°•ì›íŠ¹ë³„ìì¹˜ë„ ì² ì›êµ°ì²­', 'ê°•ì›íŠ¹ë³„ìì¹˜ë„ í™”ì²œêµ°ì²­', 'ê°•ì›íŠ¹ë³„ìì¹˜ë„ ì–‘êµ¬êµ°ì²­',
  'ê°•ì›íŠ¹ë³„ìì¹˜ë„ ì¸ì œêµ°ì²­', 'ê°•ì›íŠ¹ë³„ìì¹˜ë„ ê³ ì„±êµ°ì²­', 'ê°•ì›íŠ¹ë³„ìì¹˜ë„ ì–‘ì–‘êµ°ì²­',

  // ì¶©ì²­ë¶ë„ (11ê°œ ì‹œêµ°)
  'ì¶©ì²­ë¶ë„ ì²­ì£¼ì‹œì²­', 'ì¶©ì²­ë¶ë„ ì¶©ì£¼ì‹œì²­', 'ì¶©ì²­ë¶ë„ ì œì²œì‹œì²­', 'ì¶©ì²­ë¶ë„ ë³´ì€êµ°ì²­', 'ì¶©ì²­ë¶ë„ ì˜¥ì²œêµ°ì²­',
  'ì¶©ì²­ë¶ë„ ì˜ë™êµ°ì²­', 'ì¶©ì²­ë¶ë„ ì¦í‰êµ°ì²­', 'ì¶©ì²­ë¶ë„ ì§„ì²œêµ°ì²­', 'ì¶©ì²­ë¶ë„ ê´´ì‚°êµ°ì²­', 'ì¶©ì²­ë¶ë„ ìŒì„±êµ°ì²­', 'ì¶©ì²­ë¶ë„ ë‹¨ì–‘êµ°ì²­',

  // ì¶©ì²­ë‚¨ë„ (15ê°œ ì‹œêµ°)
  'ì¶©ì²­ë‚¨ë„ ì²œì•ˆì‹œì²­', 'ì¶©ì²­ë‚¨ë„ ê³µì£¼ì‹œì²­', 'ì¶©ì²­ë‚¨ë„ ë³´ë ¹ì‹œì²­', 'ì¶©ì²­ë‚¨ë„ ì•„ì‚°ì‹œì²­', 'ì¶©ì²­ë‚¨ë„ ì„œì‚°ì‹œì²­',
  'ì¶©ì²­ë‚¨ë„ ë…¼ì‚°ì‹œì²­', 'ì¶©ì²­ë‚¨ë„ ê³„ë£¡ì‹œì²­', 'ì¶©ì²­ë‚¨ë„ ë‹¹ì§„ì‹œì²­', 'ì¶©ì²­ë‚¨ë„ ê¸ˆì‚°êµ°ì²­', 'ì¶©ì²­ë‚¨ë„ ë¶€ì—¬êµ°ì²­',
  'ì¶©ì²­ë‚¨ë„ ì„œì²œêµ°ì²­', 'ì¶©ì²­ë‚¨ë„ ì²­ì–‘êµ°ì²­', 'ì¶©ì²­ë‚¨ë„ í™ì„±êµ°ì²­', 'ì¶©ì²­ë‚¨ë„ ì˜ˆì‚°êµ°ì²­', 'ì¶©ì²­ë‚¨ë„ íƒœì•ˆêµ°ì²­',

  // ì „ë¶íŠ¹ë³„ìì¹˜ë„ (14ê°œ ì‹œêµ°)
  'ì „ë¶íŠ¹ë³„ìì¹˜ë„ ì „ì£¼ì‹œì²­', 'ì „ë¶íŠ¹ë³„ìì¹˜ë„ êµ°ì‚°ì‹œì²­', 'ì „ë¶íŠ¹ë³„ìì¹˜ë„ ìµì‚°ì‹œì²­', 'ì „ë¶íŠ¹ë³„ìì¹˜ë„ ì •ìì‹œì²­', 'ì „ë¶íŠ¹ë³„ìì¹˜ë„ ë‚¨ì›ì‹œì²­',
  'ì „ë¶íŠ¹ë³„ìì¹˜ë„ ê¹€ì œì‹œì²­', 'ì „ë¶íŠ¹ë³„ìì¹˜ë„ ì™„ì£¼êµ°ì²­', 'ì „ë¶íŠ¹ë³„ìì¹˜ë„ ì§„ì•ˆêµ°ì²­', 'ì „ë¶íŠ¹ë³„ìì¹˜ë„ ë¬´ì£¼êµ°ì²­', 'ì „ë¶íŠ¹ë³„ìì¹˜ë„ ì¥ìˆ˜êµ°ì²­',
  'ì „ë¶íŠ¹ë³„ìì¹˜ë„ ì„ì‹¤êµ°ì²­', 'ì „ë¶íŠ¹ë³„ìì¹˜ë„ ìˆœì°½êµ°ì²­', 'ì „ë¶íŠ¹ë³„ìì¹˜ë„ ê³ ì°½êµ°ì²­', 'ì „ë¶íŠ¹ë³„ìì¹˜ë„ ë¶€ì•ˆêµ°ì²­',

  // ì „ë¼ë‚¨ë„ (22ê°œ ì‹œêµ°)
  'ì „ë¼ë‚¨ë„ ëª©í¬ì‹œì²­', 'ì „ë¼ë‚¨ë„ ì—¬ìˆ˜ì‹œì²­', 'ì „ë¼ë‚¨ë„ ìˆœì²œì‹œì²­', 'ì „ë¼ë‚¨ë„ ë‚˜ì£¼ì‹œì²­', 'ì „ë¼ë‚¨ë„ ê´‘ì–‘ì‹œì²­',
  'ì „ë¼ë‚¨ë„ ë‹´ì–‘êµ°ì²­', 'ì „ë¼ë‚¨ë„ ê³¡ì„±êµ°ì²­', 'ì „ë¼ë‚¨ë„ êµ¬ë¡€êµ°ì²­', 'ì „ë¼ë‚¨ë„ ê³ í¥êµ°ì²­', 'ì „ë¼ë‚¨ë„ ë³´ì„±êµ°ì²­',
  'ì „ë¼ë‚¨ë„ í™”ìˆœêµ°ì²­', 'ì „ë¼ë‚¨ë„ ì¥í¥êµ°ì²­', 'ì „ë¼ë‚¨ë„ ê°•ì§„êµ°ì²­', 'ì „ë¼ë‚¨ë„ í•´ë‚¨êµ°ì²­', 'ì „ë¼ë‚¨ë„ ì˜ì•”êµ°ì²­',
  'ì „ë¼ë‚¨ë„ ë¬´ì•ˆêµ°ì²­', 'ì „ë¼ë‚¨ë„ í•¨í‰êµ°ì²­', 'ì „ë¼ë‚¨ë„ ì˜ê´‘êµ°ì²­', 'ì „ë¼ë‚¨ë„ ì¥ì„±êµ°ì²­', 'ì „ë¼ë‚¨ë„ ì™„ë„êµ°ì²­',
  'ì „ë¼ë‚¨ë„ ì§„ë„êµ°ì²­', 'ì „ë¼ë‚¨ë„ ì‹ ì•ˆêµ°ì²­',

  // ê²½ìƒë¶ë„ (23ê°œ ì‹œêµ°)
  'ê²½ìƒë¶ë„ í¬í•­ì‹œì²­', 'ê²½ìƒë¶ë„ ê²½ì£¼ì‹œì²­', 'ê²½ìƒë¶ë„ ê¹€ì²œì‹œì²­', 'ê²½ìƒë¶ë„ ì•ˆë™ì‹œì²­', 'ê²½ìƒë¶ë„ êµ¬ë¯¸ì‹œì²­',
  'ê²½ìƒë¶ë„ ì˜ì£¼ì‹œì²­', 'ê²½ìƒë¶ë„ ì˜ì²œì‹œì²­', 'ê²½ìƒë¶ë„ ìƒì£¼ì‹œì²­', 'ê²½ìƒë¶ë„ ë¬¸ê²½ì‹œì²­', 'ê²½ìƒë¶ë„ ê²½ì‚°ì‹œì²­',
  'ê²½ìƒë¶ë„ êµ°ìœ„êµ°ì²­', 'ê²½ìƒë¶ë„ ì˜ì„±êµ°ì²­', 'ê²½ìƒë¶ë„ ì²­ì†¡êµ°ì²­', 'ê²½ìƒë¶ë„ ì˜ì–‘êµ°ì²­', 'ê²½ìƒë¶ë„ ì˜ë•êµ°ì²­',
  'ê²½ìƒë¶ë„ ì²­ë„êµ°ì²­', 'ê²½ìƒë¶ë„ ê³ ë ¹êµ°ì²­', 'ê²½ìƒë¶ë„ ì„±ì£¼êµ°ì²­', 'ê²½ìƒë¶ë„ ì¹ ê³¡êµ°ì²­', 'ê²½ìƒë¶ë„ ì˜ˆì²œêµ°ì²­',
  'ê²½ìƒë¶ë„ ë´‰í™”êµ°ì²­', 'ê²½ìƒë¶ë„ ìš¸ì§„êµ°ì²­', 'ê²½ìƒë¶ë„ ìš¸ë¦‰êµ°ì²­',

  // ê²½ìƒë‚¨ë„ (18ê°œ ì‹œêµ°)
  'ê²½ìƒë‚¨ë„ ì°½ì›ì‹œì²­', 'ê²½ìƒë‚¨ë„ ì§„ì£¼ì‹œì²­', 'ê²½ìƒë‚¨ë„ í†µì˜ì‹œì²­', 'ê²½ìƒë‚¨ë„ ì‚¬ì²œì‹œì²­', 'ê²½ìƒë‚¨ë„ ê¹€í•´ì‹œì²­',
  'ê²½ìƒë‚¨ë„ ë°€ì–‘ì‹œì²­', 'ê²½ìƒë‚¨ë„ ê±°ì œì‹œì²­', 'ê²½ìƒë‚¨ë„ ì–‘ì‚°ì‹œì²­', 'ê²½ìƒë‚¨ë„ ì˜ë ¹êµ°ì²­', 'ê²½ìƒë‚¨ë„ í•¨ì•ˆêµ°ì²­',
  'ê²½ìƒë‚¨ë„ ì°½ë…•êµ°ì²­', 'ê²½ìƒë‚¨ë„ ê³ ì„±êµ°ì²­', 'ê²½ìƒë‚¨ë„ ë‚¨í•´êµ°ì²­', 'ê²½ìƒë‚¨ë„ í•˜ë™êµ°ì²­', 'ê²½ìƒë‚¨ë„ ì‚°ì²­êµ°ì²­',
  'ê²½ìƒë‚¨ë„ í•¨ì–‘êµ°ì²­', 'ê²½ìƒë‚¨ë„ ê±°ì°½êµ°ì²­', 'ê²½ìƒë‚¨ë„ í•©ì²œêµ°ì²­',

  // ì œì£¼íŠ¹ë³„ìì¹˜ë„ (2ê°œ)
  'ì œì£¼íŠ¹ë³„ìì¹˜ë„ ì œì£¼ì‹œì²­', 'ì œì£¼íŠ¹ë³„ìì¹˜ë„ ì„œê·€í¬ì‹œì²­'
];

// ì¹´ì¹´ì˜¤ ì¥ì†Œ ê²€ìƒ‰ API í˜¸ì¶œ
async function searchOfficeLocation(officeName) {
  const searchTerms = [
    officeName,
    officeName.replace('ì²­', ''),
    officeName + ' ì²­ì‚¬',
    officeName.replace('íŠ¹ë³„ìì¹˜ë„', 'ë„').replace('ê´‘ì—­ì‹œ', 'ì‹œ').replace('íŠ¹ë³„ì‹œ', 'ì‹œ')
  ];

  for (const searchTerm of searchTerms) {
    try {
      const response = await fetch(
        `https://dapi.kakao.com/v2/local/search/keyword.json?query=${encodeURIComponent(searchTerm)}`,
        {
          headers: {
            'Authorization': `KakaoAK ${KAKAO_API_KEY}`
          }
        }
      );

      if (!response.ok) {
        console.log(`âŒ ${searchTerm} API í˜¸ì¶œ ì‹¤íŒ¨: ${response.status}`);
        continue;
      }

      const data = await response.json();
      
      if (data.documents && data.documents.length > 0) {
        const place = data.documents[0];
        console.log(`âœ… ${officeName} ê²€ìƒ‰ ì„±ê³µ (ê²€ìƒ‰ì–´: ${searchTerm})`);
        return {
          name: officeName,
          latitude: parseFloat(place.y),
          longitude: parseFloat(place.x)
        };
      }
      
      await delay(100);
      
    } catch (error) {
      console.error(`âŒ ${searchTerm} ê²€ìƒ‰ ì‹¤íŒ¨:`, error.message);
      continue;
    }
  }
  
  console.log(`âš ï¸ ${officeName} ëª¨ë“  ê²€ìƒ‰ì–´ë¡œ ì‹œë„í–ˆìœ¼ë‚˜ ê²°ê³¼ ì—†ìŒ`);
  return null;
}

// ì§€ì—­ëª… íŒŒì‹± í•¨ìˆ˜
function parseRegionInfo(officeName) {
  const parts = officeName.split(' ');
  let regionType = 'sigungu';
  let regionName = '';
  
  if (parts.length >= 2) {
    const sidoPart = parts[0];
    const sigunguPart = parts[1].replace('ì²­', '');
    
    if (sidoPart.includes('íŠ¹ë³„ì‹œ') || sidoPart.includes('ê´‘ì—­ì‹œ') || sidoPart.includes('íŠ¹ë³„ìì¹˜ì‹œ')) {
      regionName = sigunguPart;
    } else if (sidoPart.includes('ë„')) {
      regionName = sigunguPart;
    } else {
      regionName = sidoPart + ' ' + sigunguPart;
    }
  }
  
  return { regionType, regionName };
}

async function importAllOffices() {
  try {
    console.log('ğŸ›ï¸ ì „êµ­ ì‹œë„ì²­ ë° ì‹œêµ°êµ¬ì²­ ì¢Œí‘œ ê°€ì ¸ì˜¤ê¸° ì‹œì‘...');
    
    // ê¸°ì¡´ ë°ì´í„° ì „ë¶€ ì‚­ì œ
    await pool.query("DELETE FROM administrative_offices");
    console.log('ğŸ—‘ï¸ ê¸°ì¡´ ë°ì´í„° ì‚­ì œ ì™„ë£Œ');
    
    // 1ë‹¨ê³„: 17ê°œ ì‹œë„ì²­ ì¶”ê°€
    console.log('\nğŸ“ 1ë‹¨ê³„: 17ê°œ ì‹œë„ì²­ ì¶”ê°€ ì¤‘...');
    let sidoSuccess = 0;
    
    for (const office of SIDO_OFFICES) {
      try {
        await pool.query(`
          INSERT INTO administrative_offices (region_type, region_name, office_name, latitude, longitude)
          VALUES ($1, $2, $3, $4, $5)
        `, ['sido', office.regionName, office.name, office.lat, office.lng]);
        
        console.log(`âœ… ${office.name}: (${office.lat}, ${office.lng})`);
        sidoSuccess++;
        
      } catch (error) {
        console.error(`âŒ ${office.name} ì €ì¥ ì‹¤íŒ¨:`, error.message);
      }
    }
    
    console.log(`ğŸ“Š ì‹œë„ì²­ ì™„ë£Œ: ${sidoSuccess}/${SIDO_OFFICES.length}ê°œ`);
    
    // 2ë‹¨ê³„: 229ê°œ ì‹œêµ°êµ¬ì²­ ì¶”ê°€ (ì¹´ì¹´ì˜¤ API ì‚¬ìš©)
    console.log(`\nğŸ” 2ë‹¨ê³„: ${CITY_OFFICES.length}ê°œ ì‹œêµ°êµ¬ì²­ ê²€ìƒ‰ ë° ì¶”ê°€ ì¤‘...`);
    
    let sigunguSuccess = 0;
    let sigunguFail = 0;
    const failedOffices = [];
    
    for (let i = 0; i < CITY_OFFICES.length; i++) {
      const officeName = CITY_OFFICES[i];
      
      console.log(`ğŸ” [${i + 1}/${CITY_OFFICES.length}] ${officeName} ê²€ìƒ‰ ì¤‘...`);
      
      const result = await searchOfficeLocation(officeName);
      
      if (result) {
        try {
          const { regionType, regionName } = parseRegionInfo(officeName);
          
          await pool.query(`
            INSERT INTO administrative_offices (region_type, region_name, office_name, latitude, longitude)
            VALUES ($1, $2, $3, $4, $5)
            ON CONFLICT (region_type, region_name) 
            DO UPDATE SET 
              office_name = EXCLUDED.office_name,
              latitude = EXCLUDED.latitude,
              longitude = EXCLUDED.longitude
          `, [regionType, regionName, result.name, result.latitude, result.longitude]);
          
          console.log(`âœ… ${result.name}: (${result.latitude}, ${result.longitude})`);
          sigunguSuccess++;
          
        } catch (error) {
          console.error(`âŒ ${officeName} DB ì €ì¥ ì‹¤íŒ¨:`, error.message);
          sigunguFail++;
          failedOffices.push(officeName);
        }
      } else {
        sigunguFail++;
        failedOffices.push(officeName);
      }
      
      await delay(300);
      
      if ((i + 1) % 25 === 0) {
        console.log(`ğŸ“Š ì§„í–‰ìƒí™©: ${i + 1}/${CITY_OFFICES.length} (ì„±ê³µ: ${sigunguSuccess}, ì‹¤íŒ¨: ${sigunguFail})`);
      }
    }
    
    // ìµœì¢… í†µê³„
    const totalResult = await pool.query(`
      SELECT region_type, COUNT(*) as count 
      FROM administrative_offices 
      GROUP BY region_type 
      ORDER BY region_type
    `);
    
    console.log(`\nğŸ‰ ì „êµ­ í–‰ì •ê¸°ê´€ ì¢Œí‘œ ê°€ì ¸ì˜¤ê¸° ì™„ë£Œ!`);
    console.log(`ğŸ“Š ìµœì¢… ê²°ê³¼:`);
    totalResult.rows.forEach(stat => {
      console.log(`  - ${stat.region_type}: ${stat.count}ê°œ`);
    });
    
    const allCount = await pool.query("SELECT COUNT(*) as count FROM administrative_offices");
    console.log(`  - ì´í•©: ${allCount.rows[0].count}ê°œ`);
    
    // ì„±ê³µë¥  ê³„ì‚°
    const expectedTotal = SIDO_OFFICES.length + CITY_OFFICES.length; // 17 + 229 = 246
    const actualTotal = parseInt(allCount.rows[0].count);
    
    console.log(`\nğŸ” ê²€ì¦ ê²°ê³¼:`);
    console.log(`  - ì˜ˆìƒ ì´ ê°œìˆ˜: ${expectedTotal}ê°œ (ì‹œë„: 17ê°œ, ì‹œêµ°êµ¬: 229ê°œ)`);
    console.log(`  - ì‹¤ì œ ì €ì¥ëœ ìˆ˜: ${actualTotal}ê°œ`);
    console.log(`  - ì„±ê³µë¥ : ${((actualTotal / expectedTotal) * 100).toFixed(1)}%`);
    
    if (actualTotal >= 240) { // 97% ì´ìƒì´ë©´ ì„±ê³µìœ¼ë¡œ ê°„ì£¼
      console.log(`âœ… ê²€ì¦ ì„±ê³µ! ì¶©ë¶„í•œ ìˆ˜ì˜ í–‰ì •ê¸°ê´€ ì¢Œí‘œë¥¼ ìˆ˜ì§‘í–ˆìŠµë‹ˆë‹¤.`);
    } else {
      console.log(`âš ï¸ ì¼ë¶€ í–‰ì •ê¸°ê´€ ì¢Œí‘œë¥¼ ê°€ì ¸ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.`);
      if (failedOffices.length > 0) {
        console.log(`âŒ ì‹¤íŒ¨í•œ ê´€ì²­ë“¤ (ìµœëŒ€ 10ê°œ):`);
        for (const failed of failedOffices.slice(0, 10)) {
          console.log(`    - ${failed}`);
        }
      }
    }
    
    // ìƒ˜í”Œ ë°ì´í„° í™•ì¸
    const sidoSamples = await pool.query(`
      SELECT region_type, region_name, office_name, latitude, longitude 
      FROM administrative_offices 
      WHERE region_type = 'sido'
      ORDER BY region_name 
      LIMIT 5
    `);
    
    const sigunguSamples = await pool.query(`
      SELECT region_type, region_name, office_name, latitude, longitude 
      FROM administrative_offices 
      WHERE region_type = 'sigungu'
      ORDER BY RANDOM() 
      LIMIT 5
    `);
    
    console.log(`\nğŸ“ ì‹œë„ì²­ ìƒ˜í”Œ:`);
    sidoSamples.rows.forEach(office => {
      console.log(`  - ${office.office_name}: (${office.latitude}, ${office.longitude})`);
    });
    
    console.log(`\nğŸ“ ì‹œêµ°êµ¬ì²­ ìƒ˜í”Œ:`);
    sigunguSamples.rows.forEach(office => {
      console.log(`  - ${office.office_name}: (${office.latitude}, ${office.longitude})`);
    });
    
  } catch (error) {
    console.error('âŒ í–‰ì •ê¸°ê´€ ì¢Œí‘œ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', error);
    console.error('âŒ ì—ëŸ¬ ì„¸ë¶€ì‚¬í•­:', error.message);
  } finally {
    process.exit(0);
  }
}

// ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
importAllOffices();
