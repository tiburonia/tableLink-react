4) ì½”ì–´ ìœ í‹¸ & HTTP
core/http.js
const JSON_HEADERS = { 'Content-Type': 'application/json' };

export async function http(url, options = {}) {
  const res = await fetch(url, options);
  if (!res.ok) {
    const msg = await safeText(res);
    throw new Error(`${res.status} ${res.statusText} :: ${msg}`);
  }
  return safeJson(res);
}

function safeJson(res) {
  return res.headers.get('content-type')?.includes('application/json')
    ? res.json()
    : Promise.resolve(null);
}
function safeText(res) { return res.text().catch(() => ''); }

export const get  = (url) => http(url);
export const post = (url, body) => http(url, { method: 'POST', headers: JSON_HEADERS, body: JSON.stringify(body) });

core/storage.js
export const getItem = (k) => { try { return JSON.parse(localStorage.getItem(k)); } catch { return null; } };
export const setItem = (k, v) => localStorage.setItem(k, JSON.stringify(v));
export const removeItem = (k) => localStorage.removeItem(k);

5) ë ˆí¬ì§€í† ë¦¬ (API ì ‘ê·¼ ì „ë‹´)
repositories/storeRepo.js
import { get } from '../core/http.js';

export const storeRepo = {
  search: (q) => get(`/api/stores/search?query=${encodeURIComponent(q)}`),
  rating: (id) => get(`/api/stores/${id}/rating`),
  byViewport: ({ sw, ne }) => get(`/api/stores/within?sw=${sw}&ne=${ne}`),
};

repositories/regionRepo.js
import { get } from '../core/http.js';
export const regionRepo = {
  provinces: () => get('/api/stores/regions/provinces'),
  cities: (p) => get(`/api/stores/regions/cities?province=${encodeURIComponent(p)}`),
  districts: (p, c) => get(`/api/stores/regions/districts?province=${encodeURIComponent(p)}&city=${encodeURIComponent(c)}`),
  eupmyeondongCenter: (p,c,d) => get(`/api/stores/eupmyeondong-center?sido=${encodeURIComponent(p)}&sigungu=${encodeURIComponent(c)}&eupmyeondong=${encodeURIComponent(d)}`)
};

6) ì„œë¹„ìŠ¤ (ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§)
services/searchService.js
import { storeRepo } from '../repositories/storeRepo.js';

export const searchService = {
  async combined(keyword, mapCenter) {
    const [stores] = await Promise.all([
      storeRepo.search(keyword),
      // í•„ìš”í•˜ë©´ ì¥ì†Œê²€ìƒ‰(ì¹´ì¹´ì˜¤ REST)ì€ ì„œë²„ í”„ë¡ì‹œ í†µí•´ ë‹¤ë¥¸ repoë¡œ ë¶„ë¦¬
    ]);
    return {
      stores: stores?.stores ?? [],
      // places: ...
    };
  },
};

services/mapService.js
import { initKakaoMap } from '../integrations/kakaoMap.js';
import { storeRepo } from '../repositories/storeRepo.js';

export const mapService = {
  init(container) {
    return initKakaoMap(container, { lat: 37.5665, lng: 126.9780, level: 3 });
  },
  async loadStoresInView(map) {
    const bounds = map.getBounds();
    const sw = `${bounds.getSouthWest().getLat()},${bounds.getSouthWest().getLng()}`;
    const ne = `${bounds.getNorthEast().getLat()},${bounds.getNorthEast().getLng()}`;
    const data = await storeRepo.byViewport({ sw, ne });
    return data?.stores ?? [];
  }
};

7) ì»¨íŠ¸ë¡¤ëŸ¬ (íë¦„ ì œì–´)
controllers/mapController.js
import { mapService } from '../services/mapService.js';
import { renderMapShell, renderMarkers } from '../views/MapView.js';

export async function mountMap(root) {
  renderMapShell(root);                       // ë·° ê³¨ê²© ë¨¼ì €
  const map = mapService.init(document.getElementById('map'));
  // ì´ë²¤íŠ¸: idle ì‹œ ë·°í¬íŠ¸ ë‚´ ë§¤ì¥ ê°±ì‹ 
  kakao.maps.event.addListener(map, 'idle', async () => {
    const stores = await mapService.loadStoresInView(map);
    renderMarkers(map, stores);
  });
}

controllers/searchController.js
import { searchService } from '../services/searchService.js';
import { renderSearchResults } from '../views/SearchView.js';

export async function handleSearch(keyword, mapCenter) {
  const result = await searchService.combined(keyword, mapCenter);
  renderSearchResults(result);
}

8) ë·° (DOM ì¡°ì‘ë§Œ)
views/MapView.js
import './pages/map.css';
import { StoreCard } from './partials/StoreCard.js';

export function renderMapShell(root) {
  root.innerHTML = `
    <main id="content">
      <div id="map" class="map"></div>
      <div id="searchBar" class="searchbar"></div>
    </main>
    <nav id="bottomBar" class="bottombar"> ... </nav>
  `;
}

export function renderMarkers(map, stores) {
  // ë§ˆì»¤ ë§¤ë‹ˆì €ëŠ” ì—¬ê¸°ì„œë§Œ DOM/SDKë¥¼ ë‹¤ë£¬ë‹¤.
  // ê¸°ì¡´ window.MapMarkerManager ëŒ€ì‹  ë‚´ë¶€ í´ë¡œì €ë¡œ ê´€ë¦¬ ê¶Œì¥
  // (í•„ìš”í•˜ë©´ integrations/ ì•„ë˜ë¡œ ë§ˆì»¤ ì „ë‹´ ëª¨ë“ˆ ë¶„ë¦¬)
  console.log('render markers', stores.length);
}

export function renderStoreList(container, stores) {
  container.innerHTML = stores.map(StoreCard).join('');
}

views/partials/StoreCard.js
export function StoreCard(store) {
  return `
    <div class="store-card" data-id="${store.id}">
      <div class="store-card__title">ğŸª ${store.name}</div>
      <div class="store-card__meta">${store.category ?? ''} â€¢ â˜…${store.ratingAverage ?? '0.0'}</div>
    </div>
  `;
}

views/SearchView.js
import './pages/search.css';

export function renderSearchPage(root) {
  root.innerHTML = `
    <section class="search-page">
      <div class="search-page__bar">
        <input id="q" placeholder="ë§¤ì¥ëª…, ì¹´í…Œê³ ë¦¬, ìœ„ì¹˜"/>
        <button id="go">ê²€ìƒ‰</button>
      </div>
      <div id="result" class="search-page__result"></div>
    </section>
  `;

  document.getElementById('go').addEventListener('click', () => {
    const q = document.getElementById('q').value.trim();
    const evt = new CustomEvent('tlg:search', { detail: { q }});
    window.dispatchEvent(evt);
  });
}

export function renderSearchResults({ stores /*, places*/ }) {
  const box = document.getElementById('result');
  if (!stores?.length) {
    box.innerHTML = `<div class="empty">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;
    return;
  }
  box.innerHTML = stores.map(s => `
    <div class="result-item">
      <div class="name">${s.name}</div>
      <div class="info">${s.address ?? ''}</div>
    </div>
  `).join('');
}
