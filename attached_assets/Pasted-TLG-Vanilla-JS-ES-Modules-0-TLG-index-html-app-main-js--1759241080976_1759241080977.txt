TLG ë ˆì´ì–´ë“œ ì•„í‚¤í…ì²˜ (Vanilla JS, ES Modules)
0) ìµœìƒìœ„ êµ¬ì¡°
TLG/
  index.html
  /app
    main.js              # ì•± ì§„ì…ì  (ë¶€íŠ¸ìŠ¤íŠ¸ë©)
    router.js            # í•´ì‹œ ë¼ìš°í„°
    events.js            # ì „ì—­ ì´ë²¤íŠ¸ ë²„ìŠ¤ (pub/sub)
    constants.js         # ìƒìˆ˜, enum
  /core
    http.js              # fetch ë˜í¼ (ì—ëŸ¬/í† í°/ì¬ì‹œë„)
    storage.js           # localStorage/sessionStorage ë˜í¼
    validator.js         # ì…ë ¥ ê²€ì¦ ìœ í‹¸
    formatters.js        # ë‚ ì§œ/ê¸ˆì•¡/ë¬¸ì í¬ë§¤í„°
  /state
    appState.js          # ì „ì—­ ìƒíƒœ (ìœ ì €/ìœ„ì¹˜/ì¥ë°”êµ¬ë‹ˆ ë“±)
    createStore.js       # ê²½ëŸ‰ ìŠ¤í† ì–´(factory + subscribe)
  /repositories          # ë°ì´í„° ì ‘ê·¼ (API/ìºì‹œ/IndexedDB ë“±)
    storeRepo.js         # ë§¤ì¥ ê²€ìƒ‰/ìƒì„¸
    orderRepo.js         # ì£¼ë¬¸/ì¥ë°”êµ¬ë‹ˆ/ê²°ì œ ì¤€ë¹„
    regionRepo.js        # í–‰ì •êµ¬ì—­/ì¢Œí‘œ
    userRepo.js          # ì¸ì¦/ë‚´ ì •ë³´
  /services              # ë„ë©”ì¸ ë¡œì§ (Repoë¥¼ ì¡°ë¦½)
    searchService.js
    mapService.js
    cartService.js
    authService.js
    locationService.js
  /controllers           # íë¦„ ì œì–´ (ì´ë²¤íŠ¸â†’ì„œë¹„ìŠ¤â†’ë·°)
    mapController.js
    searchController.js
    authController.js
    cartController.js
  /views                 # ë Œë”ë§ ì „ë‹´ (DOM ì¡°ì‘ë§Œ)
    /partials            # ì»´í¬ë„ŒíŠ¸ ë‹¨ìœ„ ë·°
      SearchBar.js
      StoreCard.js
      Panel.js
      Modal.js
    MapView.js
    SearchView.js
    LoginView.js
    CartView.js
  /styles                # CSS ë ˆì´ì–´
    base.css             # reset, ë³€ìˆ˜
    layout.css           # ë ˆì´ì•„ì›ƒ(í—¤ë”/ë°”í…€ë°”/ê·¸ë¦¬ë“œ)
    components.css       # ë²„íŠ¼/ì¹´ë“œ/ëª¨ë‹¬ ë“±
    pages/
      map.css
      search.css
      login.css
      cart.css
  /integrations          # ì™¸ë¶€ SDK ì—°ë™ (ì¹´ì¹´ì˜¤ë§µ ë“±)
    kakaoMap.js          # ì§€ë„ ì¸ìŠ¤í„´ìŠ¤ ìƒì„±/í—¬í¼
    sockets.js           # (í•„ìš”ì‹œ) ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸

1) ì˜ì¡´ì„± ë°©í–¥(ì—„ìˆ˜)

views â†’ controllers ê¸ˆì§€ (ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ë·°ë¥¼ í˜¸ì¶œ)

controllers â†’ services (íë¦„ ì œì–´)

services â†’ repositories / state / core (ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§)

repositories â†’ core/http, storage

integrationsëŠ” servicesì—ì„œë§Œ ì§ì ‘ ì‚¬ìš© (ë·°ì—ì„œ ì§ì ‘ í˜¸ì¶œ ê¸ˆì§€)

views  â† controllers  â† services  â† repositories  â† core
                               â†˜ state
                               â†˜ integrations

2) ì§„ì…ì  & ë¼ìš°íŒ…
app/main.js
import { initRouter } from './router.js';
import { appState } from '../state/appState.js';
import '../styles/base.css';
import '../styles/layout.css';
import '../styles/components.css';

(async function bootstrap() {
  // ì´ˆê¸° ì „ì—­ ìƒíƒœ ë¡œë“œ (í† í°, ìœ„ì¹˜, ì¥ë°”êµ¬ë‹ˆ ë“±)
  await appState.hydrate();
  // ë¼ìš°í„° ì‹œì‘
  initRouter();
})();

app/router.js (í•´ì‹œ ê¸°ë°˜)
import { renderMapPage } from '../views/MapView.js';
import { renderSearchPage } from '../views/SearchView.js';
import { renderLoginPage } from '../views/LoginView.js';
import { renderCartPage } from '../views/CartView.js';

const routes = {
  '': renderMapPage,          // #/
  'search': renderSearchPage, // #/search?q=...
  'login': renderLoginPage,   // #/login
  'cart': renderCartPage,     // #/cart
};

export function initRouter() {
  const onRoute = () => {
    const hash = location.hash.replace(/^#\//, '');
    const [path] = hash.split('?');
    const view = routes[path || ''] || renderMapPage;
    view(document.getElementById('app')); // root ì»¨í…Œì´ë„ˆ
  };
  window.addEventListener('hashchange', onRoute);
  onRoute();
}

3) ì „ì—­ ìƒíƒœ & ìŠ¤í† ì–´
state/createStore.js
export function createStore(initialState = {}) {
  let state = { ...initialState };
  const subs = new Set();
  return {
    get: () => state,
    set: (patch) => { state = { ...state, ...patch }; subs.forEach(fn => fn(state)); },
    subscribe: (fn) => { subs.add(fn); return () => subs.delete(fn); }
  };
}

state/appState.js
import { createStore } from './createStore.js';
import { getItem, setItem } from '../core/storage.js';

const store = createStore({
  user: null,
  location: null,       // { lat, lng, text }
  cart: {},             // { menuId: qty }
});

export const appState = {
  subscribe: store.subscribe,
  get: store.get,
  set: store.set,
  async hydrate() {
    const saved = getItem('tlg_state');
    if (saved) store.set(saved);
  },
  persist() {
    setItem('tlg_state', store.get());
  }
};


ì»¨íŠ¸ë¡¤ëŸ¬/ì„œë¹„ìŠ¤ì—ì„œ appState.set({...}); appState.persist(); ì‹ìœ¼ë¡œ ì‚¬ìš©.

4) ì½”ì–´ ìœ í‹¸ & HTTP
core/http.js
const JSON_HEADERS = { 'Content-Type': 'application/json' };

export async function http(url, options = {}) {
  const res = await fetch(url, options);
  if (!res.ok) {
    const msg = await safeText(res);
    throw new Error(`${res.status} ${res.statusText} :: ${msg}`);
  }
  return safeJson(res);
}

function safeJson(res) {
  return res.headers.get('content-type')?.includes('application/json')
    ? res.json()
    : Promise.resolve(null);
}
function safeText(res) { return res.text().catch(() => ''); }

export const get  = (url) => http(url);
export const post = (url, body) => http(url, { method: 'POST', headers: JSON_HEADERS, body: JSON.stringify(body) });

core/storage.js
export const getItem = (k) => { try { return JSON.parse(localStorage.getItem(k)); } catch { return null; } };
export const setItem = (k, v) => localStorage.setItem(k, JSON.stringify(v));
export const removeItem = (k) => localStorage.removeItem(k);

5) ë ˆí¬ì§€í† ë¦¬ (API ì ‘ê·¼ ì „ë‹´)
repositories/storeRepo.js
import { get } from '../core/http.js';

export const storeRepo = {
  search: (q) => get(`/api/stores/search?query=${encodeURIComponent(q)}`),
  rating: (id) => get(`/api/stores/${id}/rating`),
  byViewport: ({ sw, ne }) => get(`/api/stores/within?sw=${sw}&ne=${ne}`),
};

repositories/regionRepo.js
import { get } from '../core/http.js';
export const regionRepo = {
  provinces: () => get('/api/stores/regions/provinces'),
  cities: (p) => get(`/api/stores/regions/cities?province=${encodeURIComponent(p)}`),
  districts: (p, c) => get(`/api/stores/regions/districts?province=${encodeURIComponent(p)}&city=${encodeURIComponent(c)}`),
  eupmyeondongCenter: (p,c,d) => get(`/api/stores/eupmyeondong-center?sido=${encodeURIComponent(p)}&sigungu=${encodeURIComponent(c)}&eupmyeondong=${encodeURIComponent(d)}`)
};

6) ì„œë¹„ìŠ¤ (ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§)
services/searchService.js
import { storeRepo } from '../repositories/storeRepo.js';

export const searchService = {
  async combined(keyword, mapCenter) {
    const [stores] = await Promise.all([
      storeRepo.search(keyword),
      // í•„ìš”í•˜ë©´ ì¥ì†Œê²€ìƒ‰(ì¹´ì¹´ì˜¤ REST)ì€ ì„œë²„ í”„ë¡ì‹œ í†µí•´ ë‹¤ë¥¸ repoë¡œ ë¶„ë¦¬
    ]);
    return {
      stores: stores?.stores ?? [],
      // places: ...
    };
  },
};

services/mapService.js
import { initKakaoMap } from '../integrations/kakaoMap.js';
import { storeRepo } from '../repositories/storeRepo.js';

export const mapService = {
  init(container) {
    return initKakaoMap(container, { lat: 37.5665, lng: 126.9780, level: 3 });
  },
  async loadStoresInView(map) {
    const bounds = map.getBounds();
    const sw = `${bounds.getSouthWest().getLat()},${bounds.getSouthWest().getLng()}`;
    const ne = `${bounds.getNorthEast().getLat()},${bounds.getNorthEast().getLng()}`;
    const data = await storeRepo.byViewport({ sw, ne });
    return data?.stores ?? [];
  }
};

7) ì»¨íŠ¸ë¡¤ëŸ¬ (íë¦„ ì œì–´)
controllers/mapController.js
import { mapService } from '../services/mapService.js';
import { renderMapShell, renderMarkers } from '../views/MapView.js';

export async function mountMap(root) {
  renderMapShell(root);                       // ë·° ê³¨ê²© ë¨¼ì €
  const map = mapService.init(document.getElementById('map'));
  // ì´ë²¤íŠ¸: idle ì‹œ ë·°í¬íŠ¸ ë‚´ ë§¤ì¥ ê°±ì‹ 
  kakao.maps.event.addListener(map, 'idle', async () => {
    const stores = await mapService.loadStoresInView(map);
    renderMarkers(map, stores);
  });
}

controllers/searchController.js
import { searchService } from '../services/searchService.js';
import { renderSearchResults } from '../views/SearchView.js';

export async function handleSearch(keyword, mapCenter) {
  const result = await searchService.combined(keyword, mapCenter);
  renderSearchResults(result);
}

8) ë·° (DOM ì¡°ì‘ë§Œ)
views/MapView.js
import './pages/map.css';
import { StoreCard } from './partials/StoreCard.js';

export function renderMapShell(root) {
  root.innerHTML = `
    <main id="content">
      <div id="map" class="map"></div>
      <div id="searchBar" class="searchbar"></div>
    </main>
    <nav id="bottomBar" class="bottombar"> ... </nav>
  `;
}

export function renderMarkers(map, stores) {
  // ë§ˆì»¤ ë§¤ë‹ˆì €ëŠ” ì—¬ê¸°ì„œë§Œ DOM/SDKë¥¼ ë‹¤ë£¬ë‹¤.
  // ê¸°ì¡´ window.MapMarkerManager ëŒ€ì‹  ë‚´ë¶€ í´ë¡œì €ë¡œ ê´€ë¦¬ ê¶Œì¥
  // (í•„ìš”í•˜ë©´ integrations/ ì•„ë˜ë¡œ ë§ˆì»¤ ì „ë‹´ ëª¨ë“ˆ ë¶„ë¦¬)
  console.log('render markers', stores.length);
}

export function renderStoreList(container, stores) {
  container.innerHTML = stores.map(StoreCard).join('');
}

views/partials/StoreCard.js
export function StoreCard(store) {
  return `
    <div class="store-card" data-id="${store.id}">
      <div class="store-card__title">ğŸª ${store.name}</div>
      <div class="store-card__meta">${store.category ?? ''} â€¢ â˜…${store.ratingAverage ?? '0.0'}</div>
    </div>
  `;
}

views/SearchView.js
import './pages/search.css';

export function renderSearchPage(root) {
  root.innerHTML = `
    <section class="search-page">
      <div class="search-page__bar">
        <input id="q" placeholder="ë§¤ì¥ëª…, ì¹´í…Œê³ ë¦¬, ìœ„ì¹˜"/>
        <button id="go">ê²€ìƒ‰</button>
      </div>
      <div id="result" class="search-page__result"></div>
    </section>
  `;

  document.getElementById('go').addEventListener('click', () => {
    const q = document.getElementById('q').value.trim();
    const evt = new CustomEvent('tlg:search', { detail: { q }});
    window.dispatchEvent(evt);
  });
}

export function renderSearchResults({ stores /*, places*/ }) {
  const box = document.getElementById('result');
  if (!stores?.length) {
    box.innerHTML = `<div class="empty">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;
    return;
  }
  box.innerHTML = stores.map(s => `
    <div class="result-item">
      <div class="name">${s.name}</div>
      <div class="info">${s.address ?? ''}</div>
    </div>
  `).join('');
}

9) ì¹´ì¹´ì˜¤ë§µ ì—°ë™ (ë¶„ë¦¬)
integrations/kakaoMap.js
export function initKakaoMap(container, { lat, lng, level }) {
  const map = new kakao.maps.Map(container, {
    center: new kakao.maps.LatLng(lat, lng),
    level
  });
  return map;
}

10) CSS ì•„í‚¤í…ì²˜

styles/base.css : ë¦¬ì…‹ + CSS ë³€ìˆ˜

styles/layout.css : ê³µí†µ ë ˆì´ì•„ì›ƒ (í—¤ë”/ë°”í…€ë°”/ê·¸ë¦¬ë“œ)

styles/components.css : ë²„íŠ¼/ì¹´ë“œ/ëª¨ë‹¬ (BEM ë„¤ì´ë°)

styles/pages/*.css : í˜ì´ì§€ ì „ìš©

ì˜ˆ: styles/base.css

:root{
  --color-primary:#297efc;
  --color-danger:#dc2626;
  --radius:16px;
  --shadow:0 8px 24px rgba(0,0,0,0.08);
}
*{box-sizing:border-box}
html,body,#app{height:100%}
body{margin:0;background:#f8f8f8;font-family:'Noto Sans KR',sans-serif}

11) ì´ë²¤íŠ¸ ë²„ìŠ¤ (ì„ íƒ)

í˜ì´ì§€-ì»´í¬ë„ŒíŠ¸ ê°„ ê²°í•© ì¤„ì´ê³  ì‹¶ìœ¼ë©´ ê°„ë‹¨í•œ pub/subë¡œ ì—°ê²°.

app/events.js
const bus = new Map(); // event -> Set<fn>

export function on(event, fn){
  if(!bus.has(event)) bus.set(event, new Set());
  bus.get(event).add(fn);
  return () => bus.get(event).delete(fn);
}
export function emit(event, payload){
  (bus.get(event) || []).forEach(fn => fn(payload));
}


ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ on('tlg:search', ...) êµ¬ë… í›„ ì„œë¹„ìŠ¤ í˜¸ì¶œ â†’ ë·° ê°±ì‹ .

12) ê°œë°œ ê·œì¹™(ìš”ì )

ë·°ëŠ” DOMë§Œ, ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ê¸ˆì§€

ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” ì´ë²¤íŠ¸ ë°”ì¸ë”© + ì„œë¹„ìŠ¤ í˜¸ì¶œë§Œ

ì„œë¹„ìŠ¤ëŠ” â€œê·œì¹™ê³¼ ì¡°ë¦½â€ë§Œ, API í˜¸ì¶œì€ ì§ì ‘ í•˜ì§€ ë§ê³  ë°˜ë“œì‹œ Repo ì‚¬ìš©

RepoëŠ” HTTP/Storageë§Œ

ì™¸ë¶€ SDK(ì¹´ì¹´ì˜¤ë§µ)ëŠ” integrationsë¡œ í•œ ê³³ì— ëª¨ìŒ

ìƒíƒœ ë³€ê²½ í›„ì—ëŠ” í•„ìš” ì‹œ appState.persist() í˜¸ì¶œ

13) ì‹œì‘ ë°©ë²•

index.htmlì—ì„œ ES ëª¨ë“ˆë¡œ app/main.js ë¡œë“œ

<script type="module" src="/TLG/app/main.js"></script>


í˜ì´ì§€ ì „í™˜ì€ location.hash = '#/search?q=...' í˜•ì‹ìœ¼ë¡œ ì‚¬ìš©

ê¸°ì¡´ renderMap() ê°™ì€ ëŒ€í˜• í•¨ìˆ˜ëŠ”

MapView ê³¨ê²© + mapController.mountMap + mapService + storeRepoë¡œ ì°¢ì–´ì„œ ì´ì „