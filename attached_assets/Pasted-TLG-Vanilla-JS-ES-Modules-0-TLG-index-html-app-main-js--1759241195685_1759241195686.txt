TLG 레이어드 아키텍처 (Vanilla JS, ES Modules)
0) 최상위 구조
TLG/
  index.html
  /app
    main.js              # 앱 진입점 (부트스트랩)
    router.js            # 해시 라우터
    events.js            # 전역 이벤트 버스 (pub/sub)
    constants.js         # 상수, enum
  /core
    http.js              # fetch 래퍼 (에러/토큰/재시도)
    storage.js           # localStorage/sessionStorage 래퍼
    validator.js         # 입력 검증 유틸
    formatters.js        # 날짜/금액/문자 포매터
  /state
    appState.js          # 전역 상태 (유저/위치/장바구니 등)
    createStore.js       # 경량 스토어(factory + subscribe)
  /repositories          # 데이터 접근 (API/캐시/IndexedDB 등)
    storeRepo.js         # 매장 검색/상세
    orderRepo.js         # 주문/장바구니/결제 준비
    regionRepo.js        # 행정구역/좌표
    userRepo.js          # 인증/내 정보
  /services              # 도메인 로직 (Repo를 조립)
    searchService.js
    mapService.js
    cartService.js
    authService.js
    locationService.js
  /controllers           # 흐름 제어 (이벤트→서비스→뷰)
    mapController.js
    searchController.js
    authController.js
    cartController.js
  /views                 # 렌더링 전담 (DOM 조작만)
    /partials            # 컴포넌트 단위 뷰
      SearchBar.js
      StoreCard.js
      Panel.js
      Modal.js
    MapView.js
    SearchView.js
    LoginView.js
    CartView.js
  /styles                # CSS 레이어
    base.css             # reset, 변수
    layout.css           # 레이아웃(헤더/바텀바/그리드)
    components.css       # 버튼/카드/모달 등
    pages/
      map.css
      search.css
      login.css
      cart.css
  /integrations          # 외부 SDK 연동 (카카오맵 등)
    kakaoMap.js          # 지도 인스턴스 생성/헬퍼
    sockets.js           # (필요시) 실시간 업데이트

1) 의존성 방향(엄수)

views → controllers 금지 (컨트롤러가 뷰를 호출)

controllers → services (흐름 제어)

services → repositories / state / core (비즈니스 로직)

repositories → core/http, storage

integrations는 services에서만 직접 사용 (뷰에서 직접 호출 금지)

views  ← controllers  ← services  ← repositories  ← core
                               ↘ state
                               ↘ integrations

2) 진입점 & 라우팅
app/main.js
import { initRouter } from './router.js';
import { appState } from '../state/appState.js';
import '../styles/base.css';
import '../styles/layout.css';
import '../styles/components.css';

(async function bootstrap() {
  // 초기 전역 상태 로드 (토큰, 위치, 장바구니 등)
  await appState.hydrate();
  // 라우터 시작
  initRouter();
})();

app/router.js (해시 기반)
import { renderMapPage } from '../views/MapView.js';
import { renderSearchPage } from '../views/SearchView.js';
import { renderLoginPage } from '../views/LoginView.js';
import { renderCartPage } from '../views/CartView.js';

const routes = {
  '': renderMapPage,          // #/
  'search': renderSearchPage, // #/search?q=...
  'login': renderLoginPage,   // #/login
  'cart': renderCartPage,     // #/cart
};

export function initRouter() {
  const onRoute = () => {
    const hash = location.hash.replace(/^#\//, '');
    const [path] = hash.split('?');
    const view = routes[path || ''] || renderMapPage;
    view(document.getElementById('app')); // root 컨테이너
  };
  window.addEventListener('hashchange', onRoute);
  onRoute();
}

3) 전역 상태 & 스토어
state/createStore.js
export function createStore(initialState = {}) {
  let state = { ...initialState };
  const subs = new Set();
  return {
    get: () => state,
    set: (patch) => { state = { ...state, ...patch }; subs.forEach(fn => fn(state)); },
    subscribe: (fn) => { subs.add(fn); return () => subs.delete(fn); }
  };
}

state/appState.js
import { createStore } from './createStore.js';
import { getItem, setItem } from '../core/storage.js';

const store = createStore({
  user: null,
  location: null,       // { lat, lng, text }
  cart: {},             // { menuId: qty }
});

export const appState = {
  subscribe: store.subscribe,
  get: store.get,
  set: store.set,
  async hydrate() {
    const saved = getItem('tlg_state');
    if (saved) store.set(saved);
  },
  persist() {
    setItem('tlg_state', store.get());
  }
};


컨트롤러/서비스에서 appState.set({...}); appState.persist(); 식으로 사용.