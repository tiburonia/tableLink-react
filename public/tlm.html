
<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TableLink Manager - ë§¤ì¥ ê´€ë¦¬</title>

  <!--ì¹´ì¹´ì˜¤ë§µ APIí‚¤-->
  <script src="//dapi.kakao.com/v2/maps/sdk.js?appkey=2da5b80696f4403357706514d7c56b70&libraries=services"></script>

  <link rel="stylesheet" href="shared/css/favoriteStore.css" />
  <link rel="stylesheet" href="shared/css/globalBody.css" />
  <link rel="stylesheet" href="shared/css/renderLogin.css" />
</head>

<body>
  <!-- í™”ë©´ì„ ë Œë”ë§í•  ë©”ì¸ ì˜ì—­ -->
  <div id='main'></div>

  <!--ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ìºì‹œ ë§¤ë‹ˆì €-->
  <script src="/TLG/utils/localStorage.js"></script>
  <!--JSON íŒŒì¼ ìºì‹œ ë§¤ë‹ˆì €-->
  <script src="/TLG/utils/cacheFileManager.js"></script>
  <!--ë¡œê·¸ì•„ì›ƒë¡œì§ í•¨ìˆ˜-->
  <script src="/TLG/utils/logOut.js"></script>
  <!--ë¡œê·¸ì¸ í™”ë©´ ë Œë”ë§ í•¨ìˆ˜-->
  <script src="/TLG/pages/auth/renderLogin.js"></script>
  <!--TLM ë©”ì¸ ë Œë”ë§ í•¨ìˆ˜-->
  <script src="/tlm-components/renderTLMMain.js"></script>

  <script>
    // ì „ì—­ ë³€ìˆ˜ ì´ˆê¸°í™”
    window.cacheManager = new CacheManager();
    
    //TLM í˜ì´ì§€ ì´ˆê¸° ì§„ì…
    document.addEventListener('DOMContentLoaded', () => {
      console.log('ğŸª TLM í˜ì´ì§€ ë¡œë”© ì‹œì‘');
      
      // ìºì‹œ ì‹œìŠ¤í…œ ì´ˆê¸°í™”
      window.cacheManager.initializeCache();
      
      // URLì—ì„œ ë§¤ì¥ ID ì¶”ì¶œ ì‹œë„
      let storeId = null;
      
      // 1. URL ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ì—ì„œ ì¶”ì¶œ (?storeId=1)
      const urlParams = new URLSearchParams(window.location.search);
      storeId = urlParams.get('storeId');
      
      // 2. URL ê²½ë¡œì—ì„œ ì¶”ì¶œ (/tlm/1 í˜•íƒœ)
      if (!storeId) {
        const pathParts = window.location.pathname.split('/');
        console.log('ğŸ” URL ê²½ë¡œ ë¶„ì„:', pathParts);
        
        if (pathParts.length >= 3 && pathParts[1].toLowerCase() === 'tlm') {
          storeId = pathParts[2];
          console.log('ğŸ¯ ê²½ë¡œì—ì„œ ë§¤ì¥ ID ì¶”ì¶œ:', storeId);
        }
      }

      console.log('ğŸª TLM í˜ì´ì§€ ì§„ì…, ë§¤ì¥ ID:', storeId);

      if (storeId && storeId !== 'null' && storeId !== 'undefined' && !isNaN(storeId)) {
        // ë§¤ì¥ IDê°€ ìˆìœ¼ë©´ TLM ë©”ì¸ í™”ë©´ ë Œë”ë§
        window.currentStoreId = parseInt(storeId);
        
        // TLM ë©”ì¸ í˜¸ì¶œ
        setTimeout(() => {
          if (typeof renderTLMMain === 'function') {
            renderTLMMain();
          } else {
            console.error('âŒ renderTLMMain í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
            alert('TLM ì‹œìŠ¤í…œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
          }
        }, 200);
      } else {
        console.log('âŒ ë§¤ì¥ IDê°€ ì—†ìŒ ë˜ëŠ” ìœ íš¨í•˜ì§€ ì•ŠìŒ, ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ ì´ë™');
        
        // ë§¤ì¥ IDê°€ ì—†ìœ¼ë©´ ë¡œê·¸ì¸ í™”ë©´ í‘œì‹œ
        setTimeout(() => {
          if (typeof renderLogin === 'function') {
            renderLogin();
          } else {
            console.error('âŒ renderLogin í•¨ìˆ˜ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
            document.getElementById('main').innerHTML = `
              <div style="padding: 20px; text-align: center; font-family: Arial, sans-serif;">
                <h2 style="color: #333;">ğŸª TableLink Manager</h2>
                <p style="color: #666; margin: 20px 0;">ë§¤ì¥ ê´€ë¦¬ ì‹œìŠ¤í…œì— ì ‘ê·¼í•˜ë ¤ë©´ ì˜¬ë°”ë¥¸ ë§¤ì¥ IDê°€ í•„ìš”í•©ë‹ˆë‹¤.</p>
                <div style="margin: 30px 0;">
                  <button onclick="window.location.href='/'" 
                          style="padding: 12px 24px; margin: 10px; background: #007bff; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 16px;">
                    ğŸ  ë©”ì¸ìœ¼ë¡œ ì´ë™
                  </button>
                  <button onclick="window.location.reload()" 
                          style="padding: 12px 24px; margin: 10px; background: #28a745; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 16px;">
                    ğŸ”„ í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
                  </button>
                </div>
                <p style="color: #999; font-size: 14px;">ì˜¬ë°”ë¥¸ URL í˜•ì‹: /tlm/[ë§¤ì¥ID]</p>
              </div>
            `;
          }
        }, 200);
      }
    });
  </script>
</body>

</html>
