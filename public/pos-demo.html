
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TableLink POS Demo</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            padding: 20px;
        }
        .header {
            border-bottom: 1px solid #eee;
            padding-bottom: 20px;
            margin-bottom: 20px;
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 6px;
        }
        .section h3 {
            margin-top: 0;
            color: #333;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        input, select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 5px;
        }
        .result {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin-top: 10px;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
        }
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        @media (max-width: 768px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸª TableLink POS Demo</h1>
            <p>POS ì‹œìŠ¤í…œ API í…ŒìŠ¤íŠ¸ ë„êµ¬</p>
            <div>
                <label>ë§¤ì¥ ID:</label>
                <input type="number" id="storeId" value="1" min="1">
                <button onclick="setStoreId()">ì„¤ì •</button>
                <span id="currentStore">í˜„ì¬ ë§¤ì¥: ë¯¸ì„¤ì •</span>
            </div>
        </div>

        <div class="grid">
            <div class="section">
                <h3>ğŸ“‹ ì²´í¬ ê´€ë¦¬</h3>
                <div>
                    <input type="number" id="tableNumber" placeholder="í…Œì´ë¸” ë²ˆí˜¸" min="1">
                    <input type="text" id="guestPhone" placeholder="ê²ŒìŠ¤íŠ¸ ì „í™”ë²ˆí˜¸ (ì„ íƒ)">
                    <br>
                    <button onclick="createCheck()">ìƒˆ ì²´í¬ ìƒì„±</button>
                </div>
                <div>
                    <input type="number" id="checkId" placeholder="ì²´í¬ ID">
                    <button onclick="getCheckSummary()">ì²´í¬ ìš”ì•½</button>
                </div>
                <div id="checkResult" class="result"></div>
            </div>

            <div class="section">
                <h3>ğŸ½ï¸ ì£¼ë¬¸ ê´€ë¦¬</h3>
                <div>
                    <input type="number" id="orderCheckId" placeholder="ì²´í¬ ID">
                    <br>
                    <input type="number" id="menuItemId" placeholder="ë©”ë‰´ ì•„ì´í…œ ID" value="1">
                    <input type="number" id="quantity" placeholder="ìˆ˜ëŸ‰" value="1" min="1">
                    <input type="number" id="unitPrice" placeholder="ë‹¨ê°€" value="10000">
                    <br>
                    <input type="text" id="specialInstructions" placeholder="íŠ¹ë³„ ìš”ì²­ì‚¬í•­">
                    <br>
                    <button onclick="addOrder()">ì£¼ë¬¸ ì¶”ê°€</button>
                </div>
                <div id="orderResult" class="result"></div>
            </div>

            <div class="section">
                <h3>ğŸ’³ ê²°ì œ ê´€ë¦¬</h3>
                <div>
                    <input type="number" id="paymentCheckId" placeholder="ì²´í¬ ID">
                    <input type="number" id="paymentAmount" placeholder="ê²°ì œ ê¸ˆì•¡">
                    <br>
                    <select id="paymentMethod">
                        <option value="CASH">í˜„ê¸ˆ</option>
                        <option value="CARD">ì¹´ë“œ</option>
                        <option value="DIGITAL">ë””ì§€í„¸</option>
                    </select>
                    <input type="text" id="paymentReference" placeholder="ê²°ì œ ì°¸ì¡° (ì„ íƒ)">
                    <br>
                    <button onclick="processPayment()">ê²°ì œ ì²˜ë¦¬</button>
                </div>
                <div id="paymentResult" class="result"></div>
            </div>

            <div class="section">
                <h3>ğŸ“Š ì‹œìŠ¤í…œ ìƒíƒœ</h3>
                <button onclick="checkHealth()">í—¬ìŠ¤ ì²´í¬</button>
                <button onclick="clearResults()">ê²°ê³¼ ì´ˆê¸°í™”</button>
                <div id="systemResult" class="result"></div>
            </div>
        </div>
    </div>

    <script>
        let currentStoreId = null;
        const API_BASE = '/api';

        function setStoreId() {
            const storeId = document.getElementById('storeId').value;
            if (storeId && parseInt(storeId) > 0) {
                currentStoreId = parseInt(storeId);
                document.getElementById('currentStore').textContent = `í˜„ì¬ ë§¤ì¥: ${currentStoreId}`;
            } else {
                alert('ìœ íš¨í•œ ë§¤ì¥ IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');
            }
        }

        function getHeaders() {
            if (!currentStoreId) {
                alert('ë¨¼ì € ë§¤ì¥ IDë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”');
                return null;
            }
            return {
                'Content-Type': 'application/json',
                'X-Store-Id': currentStoreId.toString(),
                'Idempotency-Key': 'demo-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9)
            };
        }

        async function apiCall(url, options = {}) {
            const headers = getHeaders();
            if (!headers) return;

            try {
                const response = await fetch(API_BASE + url, {
                    ...options,
                    headers: { ...headers, ...options.headers }
                });
                
                const data = await response.json();
                return { status: response.status, data };
            } catch (error) {
                return { status: 0, error: error.message };
            }
        }

        async function createCheck() {
            const tableNumber = document.getElementById('tableNumber').value;
            const guestPhone = document.getElementById('guestPhone').value;

            const body = { 
                table_number: tableNumber ? parseInt(tableNumber) : null,
                guest_phone: guestPhone || null,
                channel: 'POS',
                source: 'DEMO'
            };

            const result = await apiCall('/pos/checks', {
                method: 'POST',
                body: JSON.stringify(body)
            });

            document.getElementById('checkResult').textContent = JSON.stringify(result, null, 2);
        }

        async function getCheckSummary() {
            const checkId = document.getElementById('checkId').value;
            if (!checkId) {
                alert('ì²´í¬ IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');
                return;
            }

            const result = await apiCall(`/pos/checks/${checkId}/summary`);
            document.getElementById('checkResult').textContent = JSON.stringify(result, null, 2);
        }

        async function addOrder() {
            const checkId = document.getElementById('orderCheckId').value;
            const menuItemId = document.getElementById('menuItemId').value;
            const quantity = document.getElementById('quantity').value;
            const unitPrice = document.getElementById('unitPrice').value;
            const specialInstructions = document.getElementById('specialInstructions').value;

            if (!checkId || !menuItemId || !quantity || !unitPrice) {
                alert('ëª¨ë“  í•„ìˆ˜ í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');
                return;
            }

            const body = {
                items: [{
                    menu_item_id: parseInt(menuItemId),
                    quantity: parseInt(quantity),
                    unit_price: parseInt(unitPrice),
                    special_instructions: specialInstructions || null
                }],
                notes: 'Demo ì£¼ë¬¸'
            };

            const result = await apiCall(`/pos/checks/${checkId}/orders`, {
                method: 'POST',
                body: JSON.stringify(body)
            });

            document.getElementById('orderResult').textContent = JSON.stringify(result, null, 2);
        }

        async function processPayment() {
            const checkId = document.getElementById('paymentCheckId').value;
            const amount = document.getElementById('paymentAmount').value;
            const paymentMethod = document.getElementById('paymentMethod').value;
            const reference = document.getElementById('paymentReference').value;

            if (!checkId || !amount) {
                alert('ì²´í¬ IDì™€ ê²°ì œ ê¸ˆì•¡ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
                return;
            }

            const body = {
                amount: parseInt(amount),
                payment_method: paymentMethod,
                reference: reference || 'DEMO-' + Date.now()
            };

            const result = await apiCall(`/pos/checks/${checkId}/payments`, {
                method: 'POST',
                body: JSON.stringify(body)
            });

            document.getElementById('paymentResult').textContent = JSON.stringify(result, null, 2);
        }

        async function checkHealth() {
            try {
                const response = await fetch('/health');
                const data = await response.json();
                document.getElementById('systemResult').textContent = JSON.stringify({ status: response.status, data }, null, 2);
            } catch (error) {
                document.getElementById('systemResult').textContent = JSON.stringify({ error: error.message }, null, 2);
            }
        }

        function clearResults() {
            document.querySelectorAll('.result').forEach(el => el.textContent = '');
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ê¸°ë³¸ ë§¤ì¥ ì„¤ì •
        window.onload = function() {
            setStoreId();
        };
    </script>
</body>
</html>
