
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>POS Demo - Point of Sale</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 20px;
      background-color: #f8f9fa;
      color: #333;
    }
    .container {
      max-width: 1400px;
      margin: 0 auto;
      background: white;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .header {
      border-bottom: 2px solid #e0e0e0;
      padding-bottom: 15px;
      margin-bottom: 20px;
    }
    .header h1 {
      margin: 0;
      color: #2c3e50;
    }
    .workflow {
      display: flex;
      gap: 20px;
      margin-bottom: 30px;
    }
    .step {
      flex: 1;
      padding: 15px;
      border: 2px solid #e9ecef;
      border-radius: 8px;
      background: #f8f9fa;
      transition: all 0.3s ease;
    }
    .step.active {
      border-color: #007bff;
      background: #e7f3ff;
    }
    .step.completed {
      border-color: #28a745;
      background: #e8f5e8;
    }
    .step h3 {
      margin: 0 0 10px 0;
      color: #495057;
    }
    .step.active h3 { color: #007bff; }
    .step.completed h3 { color: #28a745; }
    .controls {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 30px;
    }
    .control-panel {
      padding: 20px;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      background: #ffffff;
    }
    .control-panel h3 {
      margin: 0 0 15px 0;
      color: #495057;
      border-bottom: 1px solid #e9ecef;
      padding-bottom: 8px;
    }
    .form-group {
      margin-bottom: 15px;
    }
    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
      font-size: 14px;
    }
    input, select, textarea, button {
      width: 100%;
      padding: 8px 12px;
      border: 1px solid #ced4da;
      border-radius: 4px;
      font-size: 14px;
      box-sizing: border-box;
    }
    button {
      background: #007bff;
      color: white;
      border: none;
      cursor: pointer;
      font-weight: bold;
      margin-top: 10px;
    }
    button:hover { background: #0056b3; }
    button:disabled {
      background: #6c757d;
      cursor: not-allowed;
    }
    .response-container {
      margin-top: 30px;
      padding: 20px;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      background: #f8f9fa;
    }
    .response-item {
      margin-bottom: 15px;
      padding: 15px;
      border-radius: 4px;
      background: white;
      border-left: 4px solid #007bff;
    }
    .response-item.success { border-left-color: #28a745; }
    .response-item.error { border-left-color: #dc3545; }
    .response-header {
      font-weight: bold;
      margin-bottom: 8px;
      color: #495057;
    }
    .response-data {
      font-family: 'Courier New', monospace;
      background: #f1f3f4;
      padding: 10px;
      border-radius: 4px;
      white-space: pre-wrap;
      font-size: 12px;
      overflow-x: auto;
    }
    .items-list {
      max-height: 200px;
      overflow-y: auto;
      border: 1px solid #dee2e6;
      border-radius: 4px;
      background: #f8f9fa;
    }
    .item-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 12px;
      border-bottom: 1px solid #e9ecef;
    }
    .item-row:last-child { border-bottom: none; }
    .remove-btn {
      background: #dc3545;
      color: white;
      border: none;
      padding: 4px 8px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
      width: auto;
      margin: 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸª POS Demo - Point of Sale System</h1>
      <p>ì²´í¬ ìƒì„± â†’ ì£¼ë¬¸ ìƒì„± â†’ ë¼ì¸ ì¶”ê°€ â†’ ìš”ì•½ â†’ ê²°ì œ ìˆœì„œë¡œ í…ŒìŠ¤íŠ¸</p>
    </div>

    <!-- ì›Œí¬í”Œë¡œìš° ë‹¨ê³„ í‘œì‹œ -->
    <div class="workflow">
      <div class="step active" id="step1">
        <h3>1. ì²´í¬ ìƒì„±</h3>
        <p>í…Œì´ë¸” ë²ˆí˜¸ì™€ ê³ ê° ì •ë³´ë¡œ ìƒˆ ì²´í¬ ìƒì„±</p>
      </div>
      <div class="step" id="step2">
        <h3>2. ì£¼ë¬¸ ìƒì„±</h3>
        <p>ì²´í¬ì— ì—°ê²°ëœ ì£¼ë¬¸ ìƒì„±</p>
      </div>
      <div class="step" id="step3">
        <h3>3. ë¼ì¸ ì¶”ê°€</h3>
        <p>ë©”ë‰´ ì•„ì´í…œì„ ì£¼ë¬¸ì— ì¶”ê°€</p>
      </div>
      <div class="step" id="step4">
        <h3>4. ìš”ì•½ ì¡°íšŒ</h3>
        <p>ì²´í¬ ìš”ì•½ ì •ë³´ í™•ì¸</p>
      </div>
      <div class="step" id="step5">
        <h3>5. ê²°ì œ</h3>
        <p>ê²°ì œ ì²˜ë¦¬ ë° ì²´í¬ ì¢…ë£Œ</p>
      </div>
    </div>

    <div class="controls">
      <!-- ì²´í¬ ìƒì„± -->
      <div class="control-panel">
        <h3>ğŸ“‹ 1. ì²´í¬ ìƒì„±</h3>
        <div class="form-group">
          <label>ë§¤ì¥ ID:</label>
          <input type="number" id="storeId" value="1" min="1">
        </div>
        <div class="form-group">
          <label>í…Œì´ë¸” ë²ˆí˜¸:</label>
          <input type="number" id="tableNumber" value="5" min="1">
        </div>
        <div class="form-group">
          <label>ê³ ê° ì „í™”ë²ˆí˜¸ (ì˜µì…˜):</label>
          <input type="text" id="guestPhone" placeholder="010-1234-5678">
        </div>
        <button onclick="createCheck()">ì²´í¬ ìƒì„±</button>
      </div>

      <!-- ì£¼ë¬¸ ìƒì„± -->
      <div class="control-panel">
        <h3>ğŸ“ 2. ì£¼ë¬¸ ìƒì„±</h3>
        <div class="form-group">
          <label>ì²´í¬ ID:</label>
          <input type="number" id="checkId" readonly>
        </div>
        <div class="form-group">
          <label>Idempotency Key:</label>
          <input type="text" id="idempotencyKey" readonly>
        </div>
        <button id="createOrderBtn" onclick="createOrder()" disabled>ì£¼ë¬¸ ìƒì„±</button>
      </div>
    </div>

    <div class="controls">
      <!-- ë¼ì¸ ì¶”ê°€ -->
      <div class="control-panel">
        <h3>ğŸ½ï¸ 3. ë¼ì¸ ì¶”ê°€</h3>
        <div class="form-group">
          <label>ì£¼ë¬¸ ID:</label>
          <input type="number" id="orderId" readonly>
        </div>
        <div class="form-group">
          <label>ë©”ë‰´ëª…:</label>
          <input type="text" id="menuName" value="ê¹€ì¹˜ì°Œê°œ">
        </div>
        <div class="form-group">
          <label>ê°€ê²©:</label>
          <input type="number" id="unitPrice" value="8000" min="0">
        </div>
        <div class="form-group">
          <label>ìˆ˜ëŸ‰:</label>
          <input type="number" id="itemCount" value="1" min="1">
        </div>
        <div class="form-group">
          <label>ì¡°ë¦¬ ìŠ¤í…Œì´ì…˜:</label>
          <select id="cookStation">
            <option value="MAIN">ë©”ì¸</option>
            <option value="FRY">íŠ€ê¹€</option>
            <option value="GRILL">ê·¸ë¦´</option>
            <option value="DRINK">ìŒë£Œ</option>
          </select>
        </div>
        <button onclick="addItem()">ì•„ì´í…œ ì¶”ê°€</button>
        
        <div class="items-list" id="itemsList" style="margin-top: 15px; display: none;">
          <div style="padding: 10px; font-weight: bold; border-bottom: 1px solid #dee2e6;">
            ì¶”ê°€ëœ ì•„ì´í…œ
          </div>
        </div>
        
        <button id="bulkCreateBtn" onclick="bulkCreateLines()" disabled style="margin-top: 10px;">
          ë¼ì¸ ìƒì„±
        </button>
      </div>

      <!-- ìš”ì•½ ë° ê²°ì œ -->
      <div class="control-panel">
        <h3>ğŸ“Š 4. ìš”ì•½ & ğŸ’³ 5. ê²°ì œ</h3>
        <button id="summaryBtn" onclick="getCheckSummary()" disabled>ìš”ì•½ ì¡°íšŒ</button>
        
        <div id="summaryResult" style="margin: 15px 0; display: none;">
          <div style="font-weight: bold; margin-bottom: 8px;">ì²´í¬ ìš”ì•½:</div>
          <div id="summaryData" class="response-data" style="max-height: 120px; overflow-y: auto;"></div>
        </div>

        <div class="form-group">
          <label>ê²°ì œ ë°©ë²•:</label>
          <select id="paymentMethod">
            <option value="CARD">ì‹ ìš©ì¹´ë“œ</option>
            <option value="CASH">í˜„ê¸ˆ</option>
            <option value="MOBILE">ëª¨ë°”ì¼</option>
          </select>
        </div>
        <div class="form-group">
          <label>ê²°ì œ ê¸ˆì•¡:</label>
          <input type="number" id="paymentAmount" value="8000" min="0">
        </div>
        <button id="paymentBtn" onclick="processPayment()" disabled>ê²°ì œ ì²˜ë¦¬</button>
      </div>
    </div>

    <!-- ì‘ë‹µ ë¡œê·¸ -->
    <div class="response-container">
      <h3>ğŸ“¡ API ì‘ë‹µ ë¡œê·¸</h3>
      <div id="responseLog"></div>
    </div>
  </div>

  <script>
    let currentStep = 1;
    let orderItems = [];

    function updateStep(step) {
      // ì´ì „ ë‹¨ê³„ë“¤ì„ ì™„ë£Œë¡œ í‘œì‹œ
      for (let i = 1; i < step; i++) {
        const stepEl = document.getElementById(`step${i}`);
        stepEl.className = 'step completed';
      }
      
      // í˜„ì¬ ë‹¨ê³„ë¥¼ í™œì„±ìœ¼ë¡œ í‘œì‹œ
      const currentStepEl = document.getElementById(`step${step}`);
      if (currentStepEl) {
        currentStepEl.className = 'step active';
      }
      
      // ë‹¤ìŒ ë‹¨ê³„ë“¤ì„ ê¸°ë³¸ìœ¼ë¡œ ì´ˆê¸°í™”
      for (let i = step + 1; i <= 5; i++) {
        const stepEl = document.getElementById(`step${i}`);
        if (stepEl) {
          stepEl.className = 'step';
        }
      }
      
      currentStep = step;
    }

    function logResponse(title, data, isError = false) {
      const responseLog = document.getElementById('responseLog');
      const responseEl = document.createElement('div');
      
      responseEl.className = isError ? 'response-item error' : 'response-item success';
      responseEl.innerHTML = `
        <div class="response-header">
          ${new Date().toLocaleTimeString('ko-KR')} - ${title}
        </div>
        <div class="response-data">${JSON.stringify(data, null, 2)}</div>
      `;
      
      responseLog.appendChild(responseEl);
      responseLog.scrollTop = responseLog.scrollHeight;
    }

    async function apiCall(method, endpoint, body = null, headers = {}) {
      const storeId = document.getElementById('storeId').value;
      
      const config = {
        method,
        headers: {
          'Content-Type': 'application/json',
          'X-Store-Id': storeId,
          ...headers
        }
      };

      if (body) {
        config.body = JSON.stringify(body);
      }

      try {
        const response = await fetch(endpoint, config);
        const data = await response.json();
        
        if (!response.ok) {
          throw new Error(`HTTP ${response.status}: ${data.message || data.error || 'Unknown error'}`);
        }
        
        return data;
      } catch (error) {
        throw error;
      }
    }

    async function createCheck() {
      try {
        const tableNumber = parseInt(document.getElementById('tableNumber').value);
        const guestPhone = document.getElementById('guestPhone').value;
        
        const body = {
          table_number: tableNumber,
          channel: 'POS',
          source: 'MANUAL'
        };
        
        if (guestPhone) {
          body.guest_phone = guestPhone;
        }

        const result = await apiCall('POST', '/api/pos/checks', body);
        
        document.getElementById('checkId').value = result.check_id;
        document.getElementById('createOrderBtn').disabled = false;
        
        // Idempotency Key ìƒì„±
        const idempotencyKey = 'pos-demo-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
        document.getElementById('idempotencyKey').value = idempotencyKey;
        
        logResponse('ì²´í¬ ìƒì„± ì„±ê³µ', result);
        updateStep(2);
        
      } catch (error) {
        logResponse('ì²´í¬ ìƒì„± ì‹¤íŒ¨', { error: error.message }, true);
      }
    }

    async function createOrder() {
      try {
        const checkId = parseInt(document.getElementById('checkId').value);
        const idempotencyKey = document.getElementById('idempotencyKey').value;
        
        const result = await apiCall('POST', '/api/pos/orders', {
          check_id: checkId,
          source: 'POS'
        }, {
          'Idempotency-Key': idempotencyKey
        });
        
        document.getElementById('orderId').value = result.order_id;
        document.getElementById('bulkCreateBtn').disabled = false;
        
        logResponse('ì£¼ë¬¸ ìƒì„± ì„±ê³µ', result);
        updateStep(3);
        
      } catch (error) {
        logResponse('ì£¼ë¬¸ ìƒì„± ì‹¤íŒ¨', { error: error.message }, true);
      }
    }

    function addItem() {
      const menuName = document.getElementById('menuName').value;
      const unitPrice = parseInt(document.getElementById('unitPrice').value);
      const count = parseInt(document.getElementById('itemCount').value);
      const cookStation = document.getElementById('cookStation').value;
      
      if (!menuName || unitPrice <= 0 || count <= 0) {
        alert('ëª¨ë“  í•„ë“œë¥¼ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•´ì£¼ì„¸ìš”');
        return;
      }

      const item = {
        menu_name: menuName,
        unit_price: unitPrice,
        count: count,
        cook_station: cookStation
      };

      orderItems.push(item);
      renderItemsList();
      
      // í¼ ì´ˆê¸°í™”
      document.getElementById('menuName').value = '';
      document.getElementById('unitPrice').value = '8000';
      document.getElementById('itemCount').value = '1';
    }

    function renderItemsList() {
      const itemsList = document.getElementById('itemsList');
      
      if (orderItems.length === 0) {
        itemsList.style.display = 'none';
        document.getElementById('bulkCreateBtn').disabled = true;
        return;
      }
      
      itemsList.style.display = 'block';
      document.getElementById('bulkCreateBtn').disabled = false;
      
      const itemsHtml = orderItems.map((item, index) => `
        <div class="item-row">
          <span>${item.menu_name} x${item.count} (â‚©${item.unit_price.toLocaleString()}) [${item.cook_station}]</span>
          <button class="remove-btn" onclick="removeItem(${index})">ì‚­ì œ</button>
        </div>
      `).join('');
      
      itemsList.innerHTML = `
        <div style="padding: 10px; font-weight: bold; border-bottom: 1px solid #dee2e6;">
          ì¶”ê°€ëœ ì•„ì´í…œ (${orderItems.length}ê°œ)
        </div>
        ${itemsHtml}
      `;
    }

    function removeItem(index) {
      orderItems.splice(index, 1);
      renderItemsList();
    }

    async function bulkCreateLines() {
      try {
        const orderId = parseInt(document.getElementById('orderId').value);
        
        if (orderItems.length === 0) {
          alert('ì¶”ê°€í•  ì•„ì´í…œì´ ì—†ìŠµë‹ˆë‹¤');
          return;
        }

        const result = await apiCall('POST', '/api/pos/order-lines/bulk', {
          order_id: orderId,
          items: orderItems
        });
        
        document.getElementById('summaryBtn').disabled = false;
        
        logResponse('ë¼ì¸ ìƒì„± ì„±ê³µ', result);
        updateStep(4);
        
        // ì•„ì´í…œ ëª©ë¡ ì´ˆê¸°í™”
        orderItems = [];
        renderItemsList();
        
      } catch (error) {
        logResponse('ë¼ì¸ ìƒì„± ì‹¤íŒ¨', { error: error.message }, true);
      }
    }

    async function getCheckSummary() {
      try {
        const checkId = parseInt(document.getElementById('checkId').value);
        
        const result = await apiCall('GET', `/api/pos/checks/${checkId}/summary`);
        
        document.getElementById('summaryResult').style.display = 'block';
        document.getElementById('summaryData').textContent = JSON.stringify(result, null, 2);
        document.getElementById('paymentAmount').value = result.due || result.final_total;
        document.getElementById('paymentBtn').disabled = false;
        
        logResponse('ìš”ì•½ ì¡°íšŒ ì„±ê³µ', result);
        updateStep(5);
        
      } catch (error) {
        logResponse('ìš”ì•½ ì¡°íšŒ ì‹¤íŒ¨', { error: error.message }, true);
      }
    }

    async function processPayment() {
      try {
        const checkId = parseInt(document.getElementById('checkId').value);
        const method = document.getElementById('paymentMethod').value;
        const amount = parseInt(document.getElementById('paymentAmount').value);
        
        if (amount <= 0) {
          alert('ê²°ì œ ê¸ˆì•¡ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
          return;
        }

        const idempotencyKey = 'payment-demo-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
        
        const result = await apiCall('POST', '/api/payments', {
          check_id: checkId,
          method: method,
          amount: amount
        }, {
          'Idempotency-Key': idempotencyKey
        });
        
        logResponse('ê²°ì œ ì²˜ë¦¬ ì„±ê³µ', result);
        
        // ì„±ê³µ ì‹œ ëª¨ë“  ë‹¨ê³„ ì™„ë£Œë¡œ í‘œì‹œ
        for (let i = 1; i <= 5; i++) {
          const stepEl = document.getElementById(`step${i}`);
          stepEl.className = 'step completed';
        }
        
        alert('ê²°ì œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
        
      } catch (error) {
        logResponse('ê²°ì œ ì²˜ë¦¬ ì‹¤íŒ¨', { error: error.message }, true);
      }
    }

    function resetDemo() {
      // í¼ ì´ˆê¸°í™”
      document.getElementById('checkId').value = '';
      document.getElementById('orderId').value = '';
      document.getElementById('idempotencyKey').value = '';
      document.getElementById('summaryResult').style.display = 'none';
      
      // ë²„íŠ¼ ìƒíƒœ ì´ˆê¸°í™”
      document.getElementById('createOrderBtn').disabled = true;
      document.getElementById('bulkCreateBtn').disabled = true;
      document.getElementById('summaryBtn').disabled = true;
      document.getElementById('paymentBtn').disabled = true;
      
      // ì•„ì´í…œ ëª©ë¡ ì´ˆê¸°í™”
      orderItems = [];
      renderItemsList();
      
      // ë‹¨ê³„ ì´ˆê¸°í™”
      updateStep(1);
      
      // ì‘ë‹µ ë¡œê·¸ ì§€ìš°ê¸°
      document.getElementById('responseLog').innerHTML = '';
    }

    // ì´ˆê¸°í™”
    document.addEventListener('DOMContentLoaded', function() {
      console.log('ğŸš€ POS Demo í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');
      renderItemsList();
    });
  </script>

  <div style="text-align: center; margin-top: 30px;">
    <button onclick="resetDemo()" style="background: #6c757d; width: auto; padding: 10px 20px;">
      ğŸ”„ ë°ëª¨ ì´ˆê¸°í™”
    </button>
  </div>
</body>
</html>
